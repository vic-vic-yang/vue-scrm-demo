webpackJsonp([73],{"1y7N":function(n,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=e("Dd8w"),i=e.n(a),s=e("YK4W"),l=e("Hkkm"),o=e("M4fF"),r=e.n(o),p=e("NYxO"),c=e("ihK9"),d={name:"my-template-list",components:{customElTable:s.a,smallProcedures:c.a},data:function(){return{tableOptions:[{label:"ID",prop:"id",width:120},{label:"标题",prop:"title"},{label:"模板ID",prop:"template_id"},{label:"状态",prop:"status_name"},{prop:"USER_ACTION",actions:[{type:"status",options:this.getStatusBtnInfo},"del"]}],tableData:[],myTemplateFrm:{id:"",title:""},pageIndex:1,pageSize:20,totalCount:0,tabLoading:!0,query:null,dialogVisible:!1,type:"data",tableShow:!0}},computed:i()({},Object(p.c)({appid:function(n){return n.templateMsg.appid},mini_program:function(n){return n.templateMsg.mini_program}})),watch:{dialogVisible:function(n){n||this.appid||(this.tabLoading=!1,this.tableShow=!1)}},created:function(){this.appid?this.getData():(this.type="data",this.dialogVisible=!0)},methods:{handleClose:function(){if(!this.appid)return this.$message("请先选择小程序，才能进行下一步操作。"),!1},switchProcedures:function(){this.dialogVisible=!0},small_procedures_handler:function(n){this.dialogVisible=n,"synchronization"===this.type?this.synchronization():this.getData()},getData:function(){var n=this,t=this.query||{};this.tabLoading=!0,l.a.my_template(i()({appid:this.appid,page_index:this.pageIndex,page_size:this.pageSize},t)).then(function(t){n.tableData=(t||[]).map(function(n){return i()({},n,{status_name:1*n.status==1?"启用":"禁用"})}),n.totalCount=1*t.totalCount,n.tabLoading=!1,n.tableShow=!0})},synchronization:function(){var n=this;this.appid?l.a.pull({appid:this.appid}).then(function(){n.$message({message:"同步微信模板消息库成功",type:"success"})}).catch(function(){n.$message({message:"同步微信模板消息库失败",type:"error"})}):(this.type="synchronization",this.dialogVisible=!0)},addTemplate:function(){this.$router.push({name:"templateLibraryList"})},searchActivityList:function(){this.query=r.a.cloneDeep(this.myTemplateFrm),this.pageIndex=1,this.getData()},createActivity:function(){this.$router.push({name:"myTemplateCreate"})},editHandler:function(n){this.$router.push({name:"myTemplateModify",params:{id:n.id}})},deleteHandler:function(n){var t=this,e="确认删除模板 <b>"+n.title+"</b> 吗？";this.$confirm(e,"删除",{dangerouslyUseHTMLString:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){l.a.del({id:n.id}).then(function(){t.getData()})}).catch(function(){t.$message({type:"info",message:"已取消删除"})})},actionHandler:function(n,t){var e=this;if("status"===n){var a=this.getStatusBtnInfo(t).label,i="确认"+a+"模板 <b>"+t.title+"</b> 吗？";this.$confirm(i,a,{dangerouslyUseHTMLString:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){l.a.status({id:t.id}).then(function(){e.getData()})}).catch(function(){e.$message({type:"info",message:"已取消"+a})})}},sizeChangeHandler:function(n){this.pageSize=n,this.pageIndex=1,this.getData()},pageChangeHandler:function(n){this.pageIndex=n,this.getData()},getStatusBtnInfo:function(n){return n?1===1*n.status?{btn:"danger",label:"禁用"}:{btn:"primary",label:"启用"}:{btn:"danger",label:"禁用"}},resetForm:function(n){this.$refs[n].resetFields()}}},m={render:function(){var n=this,t=n.$createElement,e=n._self._c||t;return e("div",{staticClass:"app-container"},[e("div",{staticClass:"control-group"},[e("el-form",{ref:"myTemplateFrm",attrs:{inline:!0,model:n.myTemplateFrm}},[e("el-form-item",{attrs:{prop:"id",label:"ID"}},[e("el-input",{attrs:{placeholder:"ID"},model:{value:n.myTemplateFrm.id,callback:function(t){n.$set(n.myTemplateFrm,"id",t)},expression:"myTemplateFrm.id"}})],1),n._v(" "),e("el-form-item",{attrs:{prop:"title",label:"标题"}},[e("el-input",{attrs:{placeholder:"标题"},model:{value:n.myTemplateFrm.title,callback:function(t){n.$set(n.myTemplateFrm,"title",t)},expression:"myTemplateFrm.title"}})],1),n._v(" "),e("el-form-item",[e("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:n.searchActivityList}},[n._v("查询")]),n._v(" "),e("el-button",{attrs:{icon:"el-icon-refresh"},on:{click:function(t){n.resetForm("myTemplateFrm")}}},[n._v("重置")])],1),n._v(" "),e("el-form-item",[e("el-button",{attrs:{type:"primary"},on:{click:n.switchProcedures}},[n._v("选择/切换小程序")]),n._v(" "),e("el-button",{attrs:{type:"primary"},on:{click:n.synchronization}},[n._v("同步小程序模板消息库")]),n._v(" "),e("el-button",{attrs:{type:"primary"},on:{click:n.addTemplate}},[n._v("添加模板")])],1),n._v(" "),n.mini_program?e("small",{staticStyle:{float:"right",color:"#111","font-weight":"bold","margin-right":"15px"}},[n._v(n._s(n.mini_program.nick_name))]):n._e()],1)],1),n._v(" "),n.tableShow?e("custom-el-table",{directives:[{name:"loading",rawName:"v-loading",value:n.tabLoading,expression:"tabLoading"}],attrs:{tableData:n.tableData,tableOptions:n.tableOptions,total:n.totalCount},on:{edit:n.editHandler,delete:n.deleteHandler,action:n.actionHandler,"size-change":n.sizeChangeHandler,"page-change":n.pageChangeHandler},model:{value:n.pageIndex,callback:function(t){n.pageIndex=t},expression:"pageIndex"}}):n._e(),n._v(" "),n.appid?n._e():e("div",{staticStyle:{"text-align":"center",padding:"100px 0 0"}},[n._v("请点击“选择/切换小程序”按钮选择小程序，然后才能进行其他操作")]),n._v(" "),e("el-dialog",{attrs:{title:"选择小程序",visible:n.dialogVisible,width:"50%"},on:{"update:visible":function(t){n.dialogVisible=t}}},[e("smallProcedures",{attrs:{name:"small"},on:{small_procedures_handler:n.small_procedures_handler}})],1)],1)},staticRenderFns:[]};var u=e("VU/8")(d,m,!1,function(n){e("cnIH")},"data-v-d198dd60",null);t.default=u.exports},JQBo:function(n,t,e){(n.exports=e("FZ+f")(!1)).push([n.i,"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",""])},cnIH:function(n,t,e){var a=e("JQBo");"string"==typeof a&&(a=[[n.i,a,""]]),a.locals&&(n.exports=a.locals);e("rjj0")("2c102e32",a,!0)}});