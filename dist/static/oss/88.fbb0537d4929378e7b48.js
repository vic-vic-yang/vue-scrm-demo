webpackJsonp([88],{"1nOO":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("Dd8w"),i=a.n(s),r=a("Hkkm"),n=a("DAYN"),l=a.n(n),o=a("NYxO"),c=a("p1Si"),d={name:"my-template-editor",components:{draggable:l.a,preview:c.a},data:function(){return{pageLoading:!1,action:this.$route.params.id?"modify":"add",template_info:{title:""},templateFrm:{id:this.$route.params.id||0,keywords:[],appid:this.$store.state.templateMsg.appid},search_name:"",keyword_list:[],select_search:[],select_keyword_list:[],frmRules:{}}},computed:i()({},Object(o.c)({appid:function(e){return e.templateMsg.appid},mini_program:function(e){return e.templateMsg.mini_program}})),created:function(){this.getData()},methods:{getData:function(){var e=this;if(this.pageLoading=!0,"add"===this.action)return this.pageLoading=!1;r.a.templates_detail({id:this.templateFrm.id}).then(function(t){e.template_info=t,e.keyword_list=t.keyword_list,e.pageLoading=!1})},keywordListChange:function(){var e=this;if(this.select_search.length>10)return this.$message({message:"最多只能选择10个关键词",type:"warning"}),!1;10===this.select_search.length&&this.$message({message:"最多只能选择10个关键词",type:"warning"}),this.select_keyword_list=[],this.select_search.map(function(t){e.keyword_list.map(function(a){a.keyword_id===t&&(a.checked=!0,e.select_keyword_list.push(a))})})},keywordsChange:function(){var e=this;this.select_keyword_list=[],this.templateFrm.keywords.map(function(t){e.keyword_list.map(function(a){a.keyword_id===t&&e.select_keyword_list.push(a)})}),this.select_search=this.templateFrm.keywords},search_code:function(){var e=this;if(this.search_name){var t=[];this.keyword_list.map(function(a){a.name.indexOf(e.search_name)>=0&&t.push(a)}),this.keyword_list=t}else this.getData()},save:function(){var e=this;if(0===this.templateFrm.keywords.length)return this.$message("请选择关键词"),!1;var t={id:this.templateFrm.id,keywords:[],appid:this.templateFrm.appid};this.select_keyword_list.map(function(e){t.keywords.push(e.keyword_id)}),r.a.add(t).then(function(){e.$router.back()})}}},p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.pageLoading,expression:"pageLoading"}],staticClass:"app-container"},[a("el-row",[a("el-col",{attrs:{span:16}},[a("el-form",{ref:"templateFrm",staticClass:"from-style",attrs:{model:e.templateFrm,rules:e.frmRules,"label-width":"120px"},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:"小程序"}},[e.mini_program?a("div",[e._v(e._s(e.mini_program.nick_name))]):e._e(),e._v(" "),a("small",{staticStyle:{color:"#999"}},[e._v("你可用该标题的模板搭配不同的关键词使用，配置提交后关键词种类和顺序将不能修改")])]),e._v(" "),a("el-form-item",{attrs:{prop:"search_name",label:"配置关键词"}},[a("el-input",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入关键词筛选",maxlength:50},nativeOn:{keydown:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key))return null;e.search_code(t)}},model:{value:e.search_name,callback:function(t){e.search_name=t},expression:"search_name"}}),e._v(" "),a("el-button",{staticStyle:{"margin-left":"15px"},attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.search_code}},[e._v("搜索")])],1),e._v(" "),a("el-form-item",{attrs:{prop:"select_search",label:""}},[a("el-checkbox-group",{attrs:{max:10},on:{change:e.keywordListChange},model:{value:e.select_search,callback:function(t){e.select_search=t},expression:"select_search"}},e._l(e.keyword_list,function(t,s){return a("el-checkbox",{key:s,staticStyle:{"min-width":"100px"},attrs:{label:t.keyword_id}},[e._v("\n              "+e._s(t.name)+"\n            ")])}))],1),e._v(" "),a("el-form-item",{attrs:{prop:"keywords",label:"已选关键词"}},[a("el-checkbox-group",{on:{change:e.keywordsChange},model:{value:e.templateFrm.keywords,callback:function(t){e.$set(e.templateFrm,"keywords",t)},expression:"templateFrm.keywords"}},[a("draggable",{staticClass:"dragArea",attrs:{list:e.select_keyword_list}},e._l(e.select_keyword_list,function(t,s){return a("el-checkbox",{key:s,staticStyle:{"min-width":"100px"},attrs:{checked:t.checked,label:t.keyword_id}},[e._v(e._s(t.name))])}))],1),e._v(" "),a("small",{staticStyle:{color:"#999"}},[e._v("可拖动关键词调整顺序；最多只能选择10个关键词")])],1),e._v(" "),a("el-form-item",[a("el-button",{on:{click:function(t){t.preventDefault(),t.stopPropagation(),e.$router.back()}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){t.preventDefault(),t.stopPropagation(),e.save(t)}}},[e._v("保存")])],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("preview",{attrs:{preview_list:e.select_keyword_list,title:e.template_info.title,tips:"预览"}})],1)],1)],1)},staticRenderFns:[]};var m=a("VU/8")(d,p,!1,function(e){a("rwKB")},"data-v-77bca1ab",null);t.default=m.exports},Bnsz:function(e,t,a){(e.exports=a("FZ+f")(!1)).push([e.i,"\n.el-checkbox[data-v-77bca1ab]{\n  margin-left: 0;\n  margin-right: 30px;\n}\n",""])},rwKB:function(e,t,a){var s=a("Bnsz");"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);a("rjj0")("76e81dec",s,!0)}});