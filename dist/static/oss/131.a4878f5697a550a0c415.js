webpackJsonp([131],{P2AR:function(t,e,a){var i=a("UnGo");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);a("rjj0")("0e02603d",i,!0)},UnGo:function(t,e,a){(t.exports=a("FZ+f")(!1)).push([t.i,"\n.el-upload-list__item[data-v-1006e636] {\n  cursor: pointer;\n}\n.el-upload-list__item:hover .el-upload-list__item-status-label[data-v-1006e636] {\n    display: block;\n}\n.el-icon-error[data-v-1006e636] {\n  font-size: 14px;\n  color: #f56c6c;\n}\n.el-icon-loading[data-v-1006e636] {\n  font-size: 14px;\n}\n.el-icon-success[data-v-1006e636] {\n  font-size: 14px;\n  color: #67c23a;\n}\n",""])},iUxW:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("Dd8w"),s=a.n(i),o=a("YK4W"),l=a("t/v+"),n=a("0xDb"),r=a("M4fF"),u=a.n(r),c=a("uzBN"),p={name:"topicList",components:{customElTable:o.a},data:function(){return{topicListQueryFrm:{title:"",status:"",time:""},query:null,statusOptions:[{value:"",label:"全部"},{value:"enable",label:"启用"},{value:"disable",label:"禁用"}],tableOptions:[{label:"编号",prop:"id",width:80},{label:"题目名称",prop:"title"},{label:"答案",prop:"answers"},{label:"正确答案",prop:"answersCorrect"},{label:"配图",prop:"picUrl",options:{type:"html"}},{label:"状态",prop:"statusTxt",options:{type:"tag",prop:"status"},width:120},{label:"添加时间",prop:"createTime",sortable:!0,width:105,className:"ph-6"},{prop:"USER_ACTION",actions:["edit",{type:"status",options:this.getStatusBtnInfo},"del"]}],tableData:[],pageIndex:1,pageSize:20,totalCount:0,tabLoading:!0,pickerOptions:{shortcuts:[{text:"最近一周",onClick:function(t){var e=new Date,a=new Date;a.setTime(a.getTime()-6048e5),t.$emit("pick",[a,e])}},{text:"最近一个月",onClick:function(t){var e=new Date,a=new Date;a.setTime(a.getTime()-2592e6),t.$emit("pick",[a,e])}},{text:"最近三个月",onClick:function(t){var e=new Date,a=new Date;a.setTime(a.getTime()-7776e6),t.$emit("pick",[a,e])}}]},questionGroupOptions:[],pageLoading:!0,groupId:this.$route.query.group,isUploadLoading:!1,uploadResultDialog:!1,uploadErrorData:[],uploadCurrentPageErrorData:[],uploadCurrentPage:1,uploadSuccessCount:0,dialogTableVisible:!1,imageClass:[],fileList:[]}},beforeRouteEnter:function(t,e,a){a(function(t){if(e&&("topicModify"===e.name||"topicCreate"===e.name)){var a=e.query;t.pageIndex=a.pageIndex||t.pageIndex,t.pageSize=a.pageSize||t.pageSize}t.getData()})},methods:{getData:function(){var t=this,e=this.query||{};this.tabLoading=!0,l.a.topic.list(s()({pageIndex:this.pageIndex,pageSize:this.pageSize,groupId:this.groupId},e)).then(function(e){t.tableData=(e.items||[]).map(function(e){return s()({},e,{answers:t.getTopicAnswer(e),answersCorrect:t.getAnswersCorrect(e),status:"enable"===e.status?1:0,statusTxt:"enable"===e.status?"启用":"禁用",createTime:Object(n.c)(e.createTime),picUrl:'<img style="max-width: 120px;height: auto" src="'+e.picUrl+'"/>'})}),t.totalCount=1*e.totalCount,t.tabLoading=t.pageLoading=!1})},getTopicAnswer:function(t){return!t.answers||t.answers.length<1?"":t.answers.map(function(t){return t.title}).join("、")},getAnswersCorrect:function(t){var e=[];return t.answers.map(function(t){t.isTrue&&e.push(t.title)}),e.map(function(t){return t}).join("、")},searchTopic:function(){this.query=u.a.cloneDeep(this.topicListQueryFrm);var t="",e="";if(this.query.time&&2===this.query.time.length){var a=this.query.time;t=a[0],e=a[1]}this.$set(this.query,"earliestCreated",t),this.$set(this.query,"lastCreated",e),this.$delete(this.query,"time"),this.pageIndex=1,this.getData()},createTopic:function(){this.$router.push({name:"topicCreate",query:{group:this.groupId,pageIndex:this.pageIndex,pageSize:this.pageSize,type:this.$route.query.type}})},editHandler:function(t){this.$router.push({name:"topicModify",params:{id:t.id},query:{pageIndex:this.pageIndex,pageSize:this.pageSize,type:this.$route.query.type}})},deleteHandler:function(t){var e=this;this.$confirm("确认删除题目 <b>"+t.title+"</b> 吗？","删除",{dangerouslyUseHTMLString:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){l.a.topic.del(t).then(function(){e.getData()})}).catch(function(){e.$message({type:"info",message:"已取消删除"})})},actionHandler:function(t,e){var a=this;if("status"===t){var i=this.$store.getters.getStatusTxt(!e.status);this.$confirm("确认"+i+"题目 <b>"+e.title+"</b> 吗？",i,{dangerouslyUseHTMLString:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){l.a.topic.status(e).then(function(){a.getData()})}).catch(function(){a.$message({type:"info",message:"已取消"+i})})}else"detail"===t&&this.$alert(e.desc,e.title,{confirmButtonText:"确定",showClose:!1}).catch(function(t){console.log("view detail : ",t)})},sizeChangeHandler:function(t){this.pageSize=t,this.pageIndex=1,this.getData()},pageChangeHandler:function(t){this.pageIndex=t,this.getData()},getStatusBtnInfo:function(t){return t?{btn:1*t.status==0?"primary":"danger",label:this.$store.getters.getStatusTxt(!t.status)}:{btn:"danger",label:"禁用"}},beforeUpload:function(){this.isUploadLoading=this.$loading({lock:!0,text:"正在导入",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"})},uploadSuccess:function(t){this.isUploadLoading.close(),this.$message({message:"导入成功",type:"success"}),this.uploadResultDialog=!0,this.uploadSuccessCount=t.successCount,this.uploadErrorData=t.failures,this.uploadCurrentPageErrorData=t.failures.slice(0,10)},uploadError:function(t){this.isUploadLoading.close(),this.$message({message:t&&t.message?t.message:"导入失败",type:"error"})},uploadPageChangeHandler:function(t){var e=10*(t-1),a=Math.min(e+10,this.uploadErrorData.length);this.uploadCurrentPageErrorData=this.uploadErrorData.slice(e,a)},uploadAction:function(t){l.a.topic.upload(this.groupId,t.file).then(this.uploadSuccess).catch(this.uploadError)},uploadImgShow:function(){this.dialogTableVisible=!0},handleSubmit:function(){this.imageClass=[],this.fileList=[],this.dialogTableVisible=!1},uploadActionImg:function(t){var e=this,a="";t.file.name&&(a=t.file.name.split(".")[0],this.fileList.push({id:a,status:2,icon:"el-icon-loading"})),c.a.img(t.file,"file",function(t){e.uploadPercent=Math.min(99,Math.floor(100*t.loaded/t.total))}).then(function(t){e.imageClass.push({id:a,picUrl:t.url}),l.a.topic.imageClass(e.imageClass).then(function(t){t.data.length>0?e.fileList.map(function(e){var a=!1;t.data.map(function(t){e.id===t.id&&(a=!0)}),a?(e.status=0,e.icon="el-icon-error"):(e.status=0,e.icon="el-icon-success")}):e.fileList.map(function(t){t.id===a&&(t.status=0,t.icon="el-icon-success")})})})}},beforeDestroy:function(){this.isUploadLoading&&this.isUploadLoading.close()}},d={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.pageLoading,expression:"pageLoading"}],staticClass:"app-container"},[a("div",{staticClass:"control-group"},[a("el-form",{attrs:{inline:!0,model:t.topicListQueryFrm}},[a("el-form-item",{attrs:{label:"题目名称"}},[a("el-input",{attrs:{placeholder:"题目名称"},model:{value:t.topicListQueryFrm.title,callback:function(e){t.$set(t.topicListQueryFrm,"title",e)},expression:"topicListQueryFrm.title"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"选择状态"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:t.topicListQueryFrm.status,callback:function(e){t.$set(t.topicListQueryFrm,"status",e)},expression:"topicListQueryFrm.status"}},t._l(t.statusOptions,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),a("el-form-item",{attrs:{label:"选择时间"}},[a("el-date-picker",{attrs:{editable:!1,type:"datetimerange","picker-options":t.pickerOptions,"range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间","value-format":"yyyy-MM-dd HH:mm:ss",align:"right"},model:{value:t.topicListQueryFrm.time,callback:function(e){t.$set(t.topicListQueryFrm,"time",e)},expression:"topicListQueryFrm.time"}})],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.searchTopic}},[t._v("查询")])],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.createTopic}},[a("i",{staticClass:"fs-13 el-icon-plus mr-5"}),t._v("新增\n         ")])],1),t._v(" "),a("el-form-item",[a("el-upload",{attrs:{action:"/api/v1/quiz/question/item/import",name:"qsFile",accept:".xls,.xlsx,.xlsm,.xltx,.xltm,.xlsb,.xlam,.csv","http-request":t.uploadAction,"before-upload":t.beforeUpload,"on-success":t.uploadSuccess,"on-error":t.uploadError,data:{groupId:t.groupId},"with-credentials":!0,"show-file-list":!1}},[a("el-button",{attrs:{type:"primary"}},[a("i",{staticClass:"el-icon-upload\nmr-5"}),t._v("导入\n           ")])],1)],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-upload"},on:{click:t.uploadImgShow}},[t._v("上传图片")])],1)],1)],1),t._v(" "),a("custom-el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.tabLoading,expression:"tabLoading"}],attrs:{tableData:t.tableData,tableOptions:t.tableOptions,total:t.totalCount,size:t.pageSize},on:{edit:t.editHandler,delete:t.deleteHandler,action:t.actionHandler,"size-change":t.sizeChangeHandler,"page-change":t.pageChangeHandler},model:{value:t.pageIndex,callback:function(e){t.pageIndex=e},expression:"pageIndex"}}),t._v(" "),a("el-dialog",{attrs:{title:"上传结果",visible:t.uploadResultDialog},on:{"update:visible":function(e){t.uploadResultDialog=e}}},[a("p",[t._v("成功："+t._s(t.uploadSuccessCount)+" 失败："),a("span",{staticStyle:{color:"#C03639"}},[t._v(t._s(t.uploadErrorData.length))])]),t._v(" "),t.uploadErrorData&&t.uploadErrorData.length>0?[a("el-table",{attrs:{data:t.uploadCurrentPageErrorData}},[a("el-table-column",{attrs:{property:"title",label:"题目名称",width:"150"}}),t._v(" "),a("el-table-column",{attrs:{property:"errors",label:"错误原因"}})],1),t._v(" "),t.uploadErrorData.length>10?a("el-pagination",{staticClass:"text-center mt-20",attrs:{background:"",layout:"prev, pager, next",total:t.uploadErrorData.length},on:{"current-change":t.uploadPageChangeHandler}}):t._e()]:t._e()],2),t._v(" "),a("el-dialog",{attrs:{title:"上传图片",width:"35%",visible:t.dialogTableVisible},on:{"update:visible":function(e){t.dialogTableVisible=e}}},[a("el-upload",{staticClass:"upload-demo",attrs:{"show-file-list":!1,action:t.$store.state.uploadImgUrl,multiple:"",drag:"","http-request":t.uploadActionImg}},[a("i",{staticClass:"el-icon-upload"}),t._v(" "),a("div",{staticClass:"el-upload__text"},[t._v("将文件拖到此处，或"),a("em",[t._v("点击上传")])]),t._v(" "),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[a("p",[t._v("只能上传jpg/png文件，且不超过5m")]),t._v(" "),t.fileList&&t.fileList.length>0?a("p",[t._v("以下上传文件中，"),a("i",{staticClass:"el-icon-success"}),t._v(" 图片与题目匹配成功，"),a("i",{staticClass:"el-icon-error"}),t._v(" 图片与题目匹配不成功")]):t._e(),t._v(" "),a("div",{staticClass:"el-upload-list el-upload-list--text"},t._l(t.fileList,function(e,i){return a("div",{key:i,staticClass:"el-upload-list__item is-success"},[a("a",{attrs:{href:"#"}},[a("i",{staticClass:"el-icon-picture"}),t._v("\n               "+t._s(e.id)+"\n             ")]),t._v(" "),a("label",{staticClass:"el-upload-list__item-status-label"},[a("i",{class:[e.icon]})])])}))])]),t._v(" "),a("div",{staticStyle:{"margin-top":"30px"}},[a("el-button",{on:{click:function(e){t.dialogTableVisible=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.handleSubmit}},[t._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var g=a("VU/8")(p,d,!1,function(t){a("P2AR")},"data-v-1006e636",null);e.default=g.exports}});