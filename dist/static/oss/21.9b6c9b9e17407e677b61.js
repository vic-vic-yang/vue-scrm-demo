webpackJsonp([21],{HK1s:function(e,n,t){(e.exports=t("FZ+f")(!1)).push([e.i,"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",""])},"pG/D":function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=t("woOf"),r=t.n(i),l=t("//Fk"),a=t.n(l),s=t("EhSW"),o=t("h9qX"),u={name:"editor",components:{},data:function(){return{pageLoading:!0,action:this.$route.params.id?"modify":"add",prizeRuleFrm:{id:this.$route.params.id||0,level:"",prize_inventory_id:"",assigned_num:0,probability_set:0,user_limit:0,stat_type:[],is_send_text:0,text_content:"",equal_prizes:[],status:0,lottery_rule_id:this.$route.query.lotteryRuleId},unassigned:0,final_probability:0,calculate_probability:0,frmRules:{level:[{required:!0,message:"奖项等级为必选项"}],prize_inventory_id:[{required:!0,message:"奖品为必选项"}],probability_set:[{validator:this.checkProbability,trigger:"blur"}],name:[{required:!0,message:"名称必填"}]},levelsOptions:[],prizeOptions:[]}},created:function(){var e=this;a.a.all([s.b.getPrizesList(),s.b.getLevelsList(),this.getDetail()]).then(function(n){e.prizeOptions=n[0],e.levelsOptions=n[1],e.pageLoading=!1})},methods:{getDetail:function(){var e=this;if("modify"===this.action)return s.b.get(this.prizeRuleFrm.id).then(function(n){var t=n.prize_rule;e.unassigned=n.unassigned,e.final_probability=n.final_probability,e.calculate_probability=n.calculate_probability;var i=1*t.stat_type;return e.prizeRuleFrm={id:t.id,level:t.level+"",prize_inventory_id:t.prize_inventory_id+"",assigned_num:t.assigned_num,probability_set:t.probability_set,user_limit:t.user_limit,stat_type:3===i?[1,2]:0===i?[]:[i],is_send_text:t.is_send_text,text_content:t.text_content,equal_prizes:t.equal_prizes?t.equal_prizes.split(","):[],is_none_prize:t.is_none_prize,status:t.status,lottery_rule_id:n.lottery_rule_id||e.prizeRuleFrm.lottery_rule_id},n}).catch(function(){e.$alert("数据获取失败，返回抽奖规则列表页面","错误",{confirmButtonText:"确定",callback:function(){e.$router.replace({name:"lotteryRule"})}})})},save:function(){var e=this,n=r()({},this.prizeRuleFrm);n.equal_prizes=n.equal_prizes.join(",");var t=n.stat_type.length;n.stat_type=0===t?0:2===t?3:1*n.stat_type[0],this.$refs.prizeRuleFrm.validate(function(t){t&&s.b.operation(n).then(function(n){e.$router.back()})})},getFinalProbability:function(e){var n=this;s.b.getFinalProbability({lotteryRuleId:this.prizeRuleFrm.lottery_rule_id,prizeRuleId:this.prizeRuleFrm.id,assignNum:e}).then(function(e){n.calculate_probability=1*e.calculate_probability,n.final_probability=n.final_probability||1*e.final_probability})},checkProbability:function(e,n,t){var i=this;s.b.checkProbability({lotteryRuleId:this.prizeRuleFrm.lottery_rule_id,prizeRuleId:this.prizeRuleFrm.id,probabilitySet:n}).then(function(){i.final_probability=n,t()}).catch(function(){t(new Error("自定义概率校验失败，请重新输入"))})},prizeInventoryChange:function(e){var n=this;o.a.get(e).then(function(e){n.unassigned=e.total-e.assigned_count})}}},p={render:function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.pageLoading,expression:"pageLoading"}],staticClass:"app-container"},[t("el-form",{ref:"prizeRuleFrm",attrs:{model:e.prizeRuleFrm,rules:e.frmRules,"label-width":"130px"}},[t("el-form-item",{attrs:{prop:"level",label:"奖项等级"}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.prizeRuleFrm.level,callback:function(n){e.$set(e.prizeRuleFrm,"level",n)},expression:"prizeRuleFrm.level"}},e._l(e.levelsOptions,function(e){return t("el-option",{key:e.id+"",attrs:{label:e.name,value:e.id+""}})}))],1),e._v(" "),t("el-form-item",{attrs:{prop:"prize_inventory_id",label:"奖品"}},[t("el-select",{attrs:{placeholder:"请选择"},on:{change:e.prizeInventoryChange},model:{value:e.prizeRuleFrm.prize_inventory_id,callback:function(n){e.$set(e.prizeRuleFrm,"prize_inventory_id",n)},expression:"prizeRuleFrm.prize_inventory_id"}},e._l(e.prizeOptions,function(e){return t("el-option",{key:e.id+"",attrs:{label:e.name,value:e.id+""}})}))],1),e._v(" "),t("el-form-item",{attrs:{label:"奖品未分配数"}},[t("span",[e._v(e._s(e.unassigned))])]),e._v(" "),t("el-form-item",{attrs:{prop:"assigned_num",label:"奖品分配数"}},[t("el-input-number",{attrs:{min:0,max:e.unassigned},on:{change:e.getFinalProbability},model:{value:e.prizeRuleFrm.assigned_num,callback:function(n){e.$set(e.prizeRuleFrm,"assigned_num",n)},expression:"prizeRuleFrm.assigned_num"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"测算中奖率(%)"}},[t("span",[e._v(e._s(e.calculate_probability)+"%")])]),e._v(" "),t("el-form-item",{attrs:{prop:"probability_set",label:"自定义中奖概率(%)"}},[t("el-input-number",{attrs:{min:0},model:{value:e.prizeRuleFrm.probability_set,callback:function(n){e.$set(e.prizeRuleFrm,"probability_set",n)},expression:"prizeRuleFrm.probability_set"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"最终中奖概率(%)"}},[t("span",[e._v(e._s(e.final_probability)+"%")])]),e._v(" "),t("el-form-item",{attrs:{prop:"user_limit",label:"单人中奖限制"}},[t("el-input-number",{model:{value:e.prizeRuleFrm.user_limit,callback:function(n){e.$set(e.prizeRuleFrm,"user_limit",n)},expression:"prizeRuleFrm.user_limit"}})],1),e._v(" "),t("el-form-item",{attrs:{prop:"stat_type",label:"单人统计标识"}},[t("el-checkbox-group",{model:{value:e.prizeRuleFrm.stat_type,callback:function(n){e.$set(e.prizeRuleFrm,"stat_type",n)},expression:"prizeRuleFrm.stat_type"}},[t("el-checkbox",{attrs:{label:1}},[e._v("微信OpenID")]),e._v(" "),t("el-checkbox",{attrs:{label:2}},[e._v("手机号")])],1)],1),e._v(" "),t("el-form-item",{attrs:{prop:"is_send_text",label:"发送中奖短信"}},[t("el-radio",{attrs:{label:0},model:{value:e.prizeRuleFrm.is_send_text,callback:function(n){e.$set(e.prizeRuleFrm,"is_send_text",n)},expression:"prizeRuleFrm.is_send_text"}},[e._v("否\n      ")]),e._v(" "),t("el-radio",{attrs:{label:1},model:{value:e.prizeRuleFrm.is_send_text,callback:function(n){e.$set(e.prizeRuleFrm,"is_send_text",n)},expression:"prizeRuleFrm.is_send_text"}},[e._v("是\n      ")])],1),e._v(" "),t("el-form-item",{attrs:{prop:"text_content",label:"短信内容"}},[t("el-input",{attrs:{type:"textarea",rows:2,name:"text_content",disabled:0===e.prizeRuleFrm.is_send_text,placeholder:"默认公司名称请以##mCoName##替代，默认奖品名称请以##mPrizeName##替代，兑奖码请以##mValidationCode##替代。"},model:{value:e.prizeRuleFrm.text_content,callback:function(n){e.$set(e.prizeRuleFrm,"text_content",n)},expression:"prizeRuleFrm.text_content"}})],1),e._v(" "),t("el-form-item",{attrs:{prop:"equal_prizes",label:"可替换奖品列表"}},[t("el-select",{staticClass:"d-block",attrs:{multiple:"","default-first-option":"",placeholder:"请选择可替换奖品"},model:{value:e.prizeRuleFrm.equal_prizes,callback:function(n){e.$set(e.prizeRuleFrm,"equal_prizes",n)},expression:"prizeRuleFrm.equal_prizes"}},e._l(e.prizeOptions,function(e){return t("el-option",{key:e.id+"",attrs:{label:e.name,value:e.id+""}})}))],1),e._v(" "),t("el-form-item",{attrs:{prop:"status",label:"启用商品"}},[t("el-radio",{attrs:{label:0},model:{value:e.prizeRuleFrm.status,callback:function(n){e.$set(e.prizeRuleFrm,"status",n)},expression:"prizeRuleFrm.status"}},[e._v("停用\n      ")]),e._v(" "),t("el-radio",{attrs:{label:1},model:{value:e.prizeRuleFrm.status,callback:function(n){e.$set(e.prizeRuleFrm,"status",n)},expression:"prizeRuleFrm.status"}},[e._v("启用\n      ")])],1),e._v(" "),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:function(n){n.stopPropagation(),n.preventDefault(),e.save(n)}}},[e._v("保存")]),e._v(" "),t("el-button",{on:{click:function(n){e.$router.back()}}},[e._v("取消")])],1)],1)],1)},staticRenderFns:[]};var _=t("VU/8")(u,p,!1,function(e){t("pTNJ")},"data-v-6464e4b8",null);n.default=_.exports},pTNJ:function(e,n,t){var i=t("HK1s");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);t("rjj0")("1f396c22",i,!0)}});