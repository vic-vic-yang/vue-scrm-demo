webpackJsonp([26],{"1fR8":function(e,t,r){var o=r("zLG6");"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);r("rjj0")("650646ef",o,!0)},"g9/D":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r("sF3O"),a=r("gyMJ"),i=function(e){return a.a.get("/missionCenter/v1/mission/missions",{params:e}).then(function(e){return e.data})},n=r("5aCZ"),s=r("QbVN"),l=r("aU9J"),p=r("0xDb"),m={name:"groupEditor",components:{Tinymce:n.a,uploadPrizeAvatar:s.a,imgCropper:l.a},data:function(){return{groupId:this.$route.params.id,action:this.$route.params.id?"modify":"add",images:[],pageIndex:1,pageSize:20,totalCount:0,view_images:[],share_images:[],wotks_page_info:{pageIndex:1,pageSize:10,totalCount:1},groupFrm:{activity_name:"",time:[],award_type:1,award:[{awardName:"",awardConter:"",awardNum:""}],award_rich:"",description:"",intro:"",share_desc:"",composition_share:"",mission_switch:0,missions:[],img:"",view_img:"",share_img:"",wp_img:"",allow_upload:1,allow_upload_max:1,entry_conditions:[],entry_condition:[],manual_check:0,vote_conditions:[],vote_condition:[],ticket_type:1,vote_time_type:1,unlock_type:1,unlock_hour:"0",next_unlock_hour:"0",content_safe:1,audit_type:1,daily_tickets:"0",daily_com_tickets:"0",vote_time:"0",adv:""},wp_img_show:!1,activeStep:0,prizeTask:null,frmRules:{activity_name:[{required:!0,message:"请输入活动标题"}],allow_upload_max:[{required:!0,message:"请输入用户在相同务中可上传的作品数"}],intro:[{required:!0,message:"请输入活动简介"}],time:[{required:!0,message:"请输入活动时间"}],award_type:[{required:!0,message:"请选择奖项类型"}],award:[{required:!0,message:"请输入奖项设置"}],img:[{required:!0,message:"请上传活动列表页配图"}],view_img:[{required:!0,message:"请上传活动详情页配图"}],share_img:[{required:!0,message:"请上传活动分享配图"}],wp_img:[{required:!0,message:"请上传公众号配图"}],allow_upload:[{required:!0,message:"请选择是否限制上传作品"}],ticket_type:[{required:!0,message:"请选择投票数"}],manual_check:[{required:!0,message:"请选择是否开启报名审核"}],vote_time_type:[{required:!0,message:"请选择投票时间"}],unlock_type:[{required:!0,message:"请选择解锁规则"}],content_safe:[{required:!0,message:"请选择智能审核"}],audit_type:[{required:!0,message:"请选择审核要求"}],description:[{required:!0,message:"请输入活动描述"}]},signGroupsOptions:["需要选手验证手机号","需要选手验证实名信息","需要选手关注指定公众号","需要选手填写姓名","需要选手填写学校信息","需要选手填写地区信息","需要选手填写详细地址"],voteGroupsOptions:["需要选手验证手机号","需要选手验证实名信息","需要选手关注指定公众号","需要选手填写姓名","需要选手填写学校信息"],matchModeOptions:[{value:0,label:"默认"},{value:1,label:"初赛"},{value:2,label:"复赛"},{value:3,label:"决赛"}],pickerOptions:{disabledDate:function(e){return e.getTime()<Date.now()-864e5}}}},created:function(){this.getPrizeTask(),this.groupId&&this.getData()},methods:{getData:function(){var e=this;o.a.activity.get(this.groupId).then(function(t){t.time=[Object(p.c)(t.start_time),Object(p.c)(t.end_time)],t.entry_conditions=[],t.vote_conditions=[],t.entry_condition.forEach(function(e){e-0==1?t.entry_conditions.push("需要选手验证手机号"):e-0==2?t.entry_conditions.push("需要选手验证实名信息"):e-0==3?t.entry_conditions.push("需要选手关注指定公众号"):e-0==4?t.entry_conditions.push("需要选手填写姓名"):e-0==5?t.entry_conditions.push("需要选手填写学校信息"):e-0==6?t.entry_conditions.push("需要选手填写地区信息"):e-0==7&&t.entry_conditions.push("需要选手填写详细地址")}),t.vote_condition.forEach(function(e){e-0==1?t.vote_conditions.push("需要选手验证手机号"):e-0==2?t.vote_conditions.push("需要选手验证实名信息"):e-0==3?t.vote_conditions.push("需要选手关注指定公众号"):e-0==4?t.vote_conditions.push("需要选手填写姓名"):e-0==5&&t.vote_conditions.push("需要选手填写学校信息")}),t.mission_switch=Boolean(1*t.extend.mission_switch),t.missions=t.extend.missions,t.share_desc=t.extend.share_desc,t.composition_share=t.extend.composition_share,e.groupFrm=t,(!e.groupFrm.award||e.groupFrm.award.length<1)&&(e.groupFrm.award=[{awardName:"",awardConter:"",awardNum:""}]),e.images=[{file_path:e.groupFrm.img}],e.view_images=[{file_path:e.groupFrm.view_img}],e.share_images=[{file_path:e.groupFrm.share_img}]})},changeExamine:function(){var e=this.groupFrm.entry_conditions.find(function(e){return"需要选手关注指定公众号"===e}),t=this.groupFrm.vote_conditions.find(function(e){return"需要选手关注指定公众号"===e});e||t?(this.wp_img_show=!0,this.frmRules.wp_img[0].required=!0):(this.wp_img_show=!1,this.frmRules.wp_img[0].required=!1)},getPrizeTask:function(){var e=this,t={page_size:this.wotks_page_info.pageSize,page_index:this.wotks_page_info.pageIndex};i(t).then(function(t){e.wotks_page_info={pageIndex:1*t.pageIndex,pageSize:1*t.pageSize,totalCount:1*t.totalCount},e.prizeTask=t.result})},currentChangeActivity:function(e){this.wotks_page_info.pageIndex=e,this.getPrizeTask()},save:function(){var e=this;this.$refs.groupFrm.validate(function(t){t&&(e.groupFrm.start_time=e.groupFrm.time[0],e.groupFrm.end_time=e.groupFrm.time[1],e.groupFrm.entry_condition=[],e.groupFrm.entry_conditions.forEach(function(t){"需要选手验证手机号"===t?e.groupFrm.entry_condition.push(1):"需要选手验证实名信息"===t?e.groupFrm.entry_condition.push(2):"需要选手关注指定公众号"===t?e.groupFrm.entry_condition.push(3):"需要选手填写姓名"===t?e.groupFrm.entry_condition.push(4):"需要选手填写学校信息"===t?e.groupFrm.entry_condition.push(5):"需要选手填写地区信息"===t?e.groupFrm.entry_condition.push(6):"需要选手填写详细地址"===t&&e.groupFrm.entry_condition.push(7)}),e.groupFrm.vote_condition=[],e.groupFrm.vote_conditions.forEach(function(t){"需要选手验证手机号"===t?e.groupFrm.vote_condition.push(1):"需要选手验证实名信息"===t?e.groupFrm.vote_condition.push(2):"需要选手关注指定公众号"===t?e.groupFrm.vote_condition.push(3):"需要选手填写姓名"===t?e.groupFrm.vote_condition.push(4):"需要选手填写学校信息"===t&&e.groupFrm.vote_condition.push(5)}),("modify"===e.action?o.a.activity.edit(e.groupFrm):o.a.activity.add(e.groupFrm)).then(function(t){"modify"!==e.action?e.$confirm("添加活动成功，是否开始配置阶段？","确认信息",{distinguishCancelAndClose:!0,closeOnClickModal:!1,confirmButtonText:"是",cancelButtonText:"否"}).then(function(r){e.$router.replace({name:"newStage",params:{activityId:t.data.id}})}).catch(function(t){e.$router.replace({name:"voteActivity"})}):e.$router.replace({name:"voteActivity"})}))})},get_pic:function(e){this.images=e,this.groupFrm.img=e[0]&&e[0].file_path?e[0].file_path:""},get_piv:function(e){this.view_images=e,this.groupFrm.view_img=e[0]&&e[0].file_path?e[0].file_path:""},get_pis:function(e){this.share_images=e,this.groupFrm.share_img=e[0]&&e[0].file_path?e[0].file_path:""},addAward:function(){this.groupFrm.award.push({awardName:"",awardConter:"",awardNum:""})},deleteAward:function(e){this.groupFrm.award.length>1&&this.groupFrm.award.splice(e,1)},nextStep:function(e){var t=this;e>this.activeStep?this.$refs.groupFrm.validate(function(r){r&&(t.activeStep=e,t.$refs.groupFrm.clearValidate())}):(this.activeStep=e,this.$refs.groupFrm.clearValidate())}}},u={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app-container"},[r("el-steps",{staticStyle:{"margin-bottom":"15px"},attrs:{active:e.activeStep,"finish-status":"success",simple:""}},[r("el-step",{attrs:{title:"活动信息"}}),e._v(" "),r("el-step",{attrs:{title:"比赛信息"}})],1),e._v(" "),r("el-form",{ref:"groupFrm",staticClass:"code-add__frm",attrs:{model:e.groupFrm,rules:e.frmRules,"label-width":"100px"}},[0===e.activeStep?[r("el-form-item",{attrs:{prop:"activity_name",maxlength:40,label:"活动标题"}},[r("el-input",{attrs:{name:"matchName",clearable:!0,placeholder:"请输入活动标题(限40字)"},model:{value:e.groupFrm.activity_name,callback:function(t){e.$set(e.groupFrm,"activity_name",t)},expression:"groupFrm.activity_name"}})],1),e._v(" "),r("el-form-item",{attrs:{prop:"description",label:"活动说明"}},[r("tinymce",{attrs:{placeholder:"请输入活动说明",height:300},model:{value:e.groupFrm.description,callback:function(t){e.$set(e.groupFrm,"description",t)},expression:"groupFrm.description"}})],1),e._v(" "),r("el-form-item",{attrs:{prop:"intro",label:"活动简介"}},[r("el-input",{attrs:{name:"matchIntro",clearable:!0,maxlength:50,placeholder:"请输入活动简介(限50字)"},model:{value:e.groupFrm.intro,callback:function(t){e.$set(e.groupFrm,"intro",t)},expression:"groupFrm.intro"}})],1),e._v(" "),r("el-form-item",{attrs:{prop:"time",label:"活动时间"}},[r("el-date-picker",{attrs:{editable:!1,type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间","value-format":"yyyy-MM-dd HH:mm:ss",align:"left","picker-options":e.pickerOptions},model:{value:e.groupFrm.time,callback:function(t){e.$set(e.groupFrm,"time",t)},expression:"groupFrm.time"}})],1),e._v(" "),2==e.groupFrm.award_type?r("el-form-item",{attrs:{prop:"award_rich",label:"奖项设置"}},[r("tinymce",{attrs:{placeholder:"请输入比赛说明",height:300},model:{value:e.groupFrm.award_rich,callback:function(t){e.$set(e.groupFrm,"award_rich",t)},expression:"groupFrm.award_rich"}})],1):e._e(),e._v(" "),e._e(),e._v(" "),r("el-form-item",{attrs:{prop:"img",label:"活动列表配图"}},[r("upload-prize-avatar",{model:{value:e.groupFrm.img,callback:function(t){e.$set(e.groupFrm,"img",t)},expression:"groupFrm.img"}}),e._v(" "),r("small",{staticStyle:{color:"#999"}},[e._v("建议尺寸700*390")])],1),e._v(" "),r("el-form-item",{attrs:{prop:"view_img",label:"活动详情页配图","label-width":"90px"}},[r("upload-prize-avatar",{model:{value:e.groupFrm.view_img,callback:function(t){e.$set(e.groupFrm,"view_img",t)},expression:"groupFrm.view_img"}}),e._v(" "),r("small",{staticStyle:{color:"#999"}},[e._v("建议尺寸750*578")])],1),e._v(" "),r("el-form-item",{attrs:{prop:"share_img",label:"活动分享配图"}},[r("upload-prize-avatar",{model:{value:e.groupFrm.share_img,callback:function(t){e.$set(e.groupFrm,"share_img",t)},expression:"groupFrm.share_img"}}),e._v(" "),r("small",{staticStyle:{color:"#999"}},[e._v("建议尺寸630*454")])],1),e._v(" "),r("el-form-item",{attrs:{prop:"share_desc",label:"活动分享语"}},[r("el-input",{attrs:{name:"share_desc",maxlength:40,clearable:!0,placeholder:"请输入活动分享语，不填默认取活动名称(限40字)"},model:{value:e.groupFrm.share_desc,callback:function(t){e.$set(e.groupFrm,"share_desc",t)},expression:"groupFrm.share_desc"}})],1),e._v(" "),r("el-form-item",{attrs:{prop:"composition_share",label:"作品分享语"}},[r("el-input",{attrs:{name:"composition_share",maxlength:40,clearable:!0,placeholder:"请输入作品分享语，不填默认取作品名称(限40字)"},model:{value:e.groupFrm.composition_share,callback:function(t){e.$set(e.groupFrm,"composition_share",t)},expression:"groupFrm.composition_share"}})],1),e._v(" "),r("el-form-item",{attrs:{prop:"task_type",label:"有奖任务"}},[r("el-switch",{model:{value:e.groupFrm.mission_switch,callback:function(t){e.$set(e.groupFrm,"mission_switch",t)},expression:"groupFrm.mission_switch"}}),e._v(" "),e.groupFrm.mission_switch?[r("el-select",{staticStyle:{display:"block"},attrs:{placeholder:"请选择任务类型",multiple:""},model:{value:e.groupFrm.missions,callback:function(t){e.$set(e.groupFrm,"missions",t)},expression:"groupFrm.missions"}},[e._l(e.prizeTask,function(e){return r("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),e._v(" "),r("div",{staticClass:"article_pages"},[r("el-pagination",{attrs:{"page-size":e.wotks_page_info.pageSize,"pager-count":Math.ceil(e.wotks_page_info.totalCount/e.wotks_page_info.pageSize),"current-page":e.wotks_page_info.pageIndex,layout:"prev, pager, next",total:e.wotks_page_info.totalCount},on:{"current-change":e.currentChangeActivity}})],1)],2)]:e._e()],2),e._v(" "),r("el-form-item",[r("el-button",{on:{click:function(t){e.$router.back()}}},[e._v("取消")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:function(t){t.stopPropagation(),e.nextStep(1)}}},[e._v("下一步")])],1)]:e._e(),e._v(" "),1===e.activeStep?[e._e(),e._v(" "),r("el-form-item",{attrs:{prop:"allow_upload",label:"用户作品上传"}},[r("div",[r("el-radio-group",{model:{value:e.groupFrm.allow_upload,callback:function(t){e.$set(e.groupFrm,"allow_upload",t)},expression:"groupFrm.allow_upload"}},[r("el-radio",{attrs:{label:0}},[e._v("关")]),e._v(" "),r("el-radio",{attrs:{label:1}},[e._v("开")])],1)],1),e._v(" "),r("small",{staticClass:"text-999"},[e._v("是否允许用户在小程序端参赛并且上传作品")])]),e._v(" "),1==e.groupFrm.allow_upload?r("el-form-item",{attrs:{prop:"allow_upload_max",label:"相同任务中上传作品数"}},[r("el-input",{staticStyle:{width:"120px"},attrs:{type:"number"},model:{value:e.groupFrm.allow_upload_max,callback:function(t){e.$set(e.groupFrm,"allow_upload_max",t)},expression:"groupFrm.allow_upload_max"}})],1):e._e(),e._v(" "),1==e.groupFrm.allow_upload?r("el-form-item",{attrs:{prop:"entry_conditions",label:"报名要求"}},[r("el-checkbox-group",{staticClass:"switch-flex",on:{change:function(t){e.changeExamine("entry_conditions")}},model:{value:e.groupFrm.entry_conditions,callback:function(t){e.$set(e.groupFrm,"entry_conditions",t)},expression:"groupFrm.entry_conditions"}},e._l(e.signGroupsOptions,function(e,t){return r("el-checkbox",{key:t,attrs:{label:e}})})),e._v(" "),r("small",{staticClass:"text-999"},[e._v("多选为所有规则都需要满足才能报名，不选则为没有限制")])],1):e._e(),e._v(" "),1==e.groupFrm.allow_upload?r("el-form-item",{attrs:{prop:"manual_check",label:"报名审核"}},[r("el-radio-group",{model:{value:e.groupFrm.manual_check,callback:function(t){e.$set(e.groupFrm,"manual_check",t)},expression:"groupFrm.manual_check"}},[r("el-radio",{attrs:{label:0}},[e._v("关")]),e._v(" "),r("el-radio",{attrs:{label:1}},[e._v("开")])],1)],1):e._e(),e._v(" "),r("el-form-item",{attrs:{prop:"vote_conditions",label:"投票要求"}},[r("el-checkbox-group",{staticClass:"switch-flex",on:{change:function(t){e.changeExamine("vote_conditions")}},model:{value:e.groupFrm.vote_conditions,callback:function(t){e.$set(e.groupFrm,"vote_conditions",t)},expression:"groupFrm.vote_conditions"}},e._l(e.voteGroupsOptions,function(e,t){return r("el-checkbox",{key:t,attrs:{label:e}})})),e._v(" "),r("small",{staticClass:"text-999"},[e._v("多选为所有规则都需要满足才能投票，不选则为没有限制")])],1),e._v(" "),e.wp_img_show?[r("el-form-item",{attrs:{prop:"wp_img",label:"公众号配图","label-width":"90px"}},[r("upload-prize-avatar",{model:{value:e.groupFrm.wp_img,callback:function(t){e.$set(e.groupFrm,"wp_img",t)},expression:"groupFrm.wp_img"}})],1)]:e._e(),e._v(" "),r("el-form-item",{attrs:{prop:"ticket_type",label:"投票数"}},[r("el-radio-group",{staticStyle:{width:"500px"},model:{value:e.groupFrm.ticket_type,callback:function(t){e.$set(e.groupFrm,"ticket_type",t)},expression:"groupFrm.ticket_type"}},[r("el-radio",{attrs:{label:1}},[e._v("活动期间只有一票")]),e._v(" "),r("el-radio",{attrs:{label:2}},[e._v("活动期间可投多票")])],1)],1),e._v(" "),2==e.groupFrm.ticket_type?r("el-form-item",[r("div",{staticClass:"editor-item"},[r("div",[e._v("\n            活动期间系统每天赠送\n            "),r("el-input",{staticStyle:{width:"60px"},attrs:{name:"matchName"},model:{value:e.groupFrm.daily_tickets,callback:function(t){e.$set(e.groupFrm,"daily_tickets",t)},expression:"groupFrm.daily_tickets"}}),e._v("\n            票\n          ")],1),e._v(" "),r("div",[e._v("\n            每人每天可为同一作品投\n            "),r("el-input",{staticStyle:{width:"60px"},attrs:{name:"matchName"},model:{value:e.groupFrm.daily_com_tickets,callback:function(t){e.$set(e.groupFrm,"daily_com_tickets",t)},expression:"groupFrm.daily_com_tickets"}}),e._v("\n            票\n          ")],1)])]):e._e(),e._v(" "),r("el-form-item",{attrs:{prop:"vote_time_type",label:"投票时间"}},[r("el-radio-group",{model:{value:e.groupFrm.vote_time_type,callback:function(t){e.$set(e.groupFrm,"vote_time_type",t)},expression:"groupFrm.vote_time_type"}},[r("el-radio",{attrs:{label:1}},[e._v("用户作品提交成功后即可开始投票")]),e._v(" "),r("el-radio",{attrs:{label:2}},[e._v("活动各阶段开始\n            "),r("el-input",{staticStyle:{width:"60px"},attrs:{name:"matchName",disabled:1==e.groupFrm.vote_time_type},model:{value:e.groupFrm.vote_time,callback:function(t){e.$set(e.groupFrm,"vote_time",t)},expression:"groupFrm.vote_time"}}),e._v("小时后可开始投票\n          ")],1)],1)],1),e._v(" "),1==e.groupFrm.allow_upload?r("el-form-item",{staticStyle:{width:"860px"},attrs:{prop:"unlock_type",label:"任务解锁规则"}},[r("el-radio-group",{model:{value:e.groupFrm.unlock_type,callback:function(t){e.$set(e.groupFrm,"unlock_type",t)},expression:"groupFrm.unlock_type"}},[r("el-radio",{attrs:{label:1}},[e._v("上一任务解锁时间达到\n            "),r("el-input",{staticStyle:{width:"60px"},attrs:{name:"matchName",disabled:2==e.groupFrm.unlock_type},model:{value:e.groupFrm.unlock_hour,callback:function(t){e.$set(e.groupFrm,"unlock_hour",t)},expression:"groupFrm.unlock_hour"}}),e._v("小时后解锁下一任务\n          ")],1),e._v(" "),r("el-radio",{attrs:{label:2}},[e._v("当用户完成上一任务时间达到\n            "),r("el-input",{staticStyle:{width:"60px"},attrs:{name:"matchName",disabled:1==e.groupFrm.unlock_type},model:{value:e.groupFrm.next_unlock_hour,callback:function(t){e.$set(e.groupFrm,"next_unlock_hour",t)},expression:"groupFrm.next_unlock_hour"}}),e._v("小时后解锁下一任务\n          ")],1)],1),e._v(" "),r("small",{staticClass:"text-999"},[e._v("填0即为所有任务默认开启")])],1):e._e(),e._v(" "),1==e.groupFrm.allow_upload?r("el-form-item",{attrs:{prop:"content_safe",label:"智能审核"}},[r("el-radio-group",{model:{value:e.groupFrm.content_safe,callback:function(t){e.$set(e.groupFrm,"content_safe",t)},expression:"groupFrm.content_safe"}},[r("el-radio",{attrs:{label:0}},[e._v("关")]),e._v(" "),r("el-radio",{attrs:{label:1}},[e._v("开")])],1)],1):e._e(),e._v(" "),1==e.groupFrm.allow_upload&&0==e.groupFrm.content_safe?r("el-form-item",{attrs:{prop:"audit_type",label:"审核方式"}},[r("el-radio-group",{model:{value:e.groupFrm.audit_type,callback:function(t){e.$set(e.groupFrm,"audit_type",t)},expression:"groupFrm.audit_type"}},[r("el-radio",{attrs:{label:1}},[e._v("先发后审")]),e._v(" "),r("el-radio",{attrs:{label:2}},[e._v("先审后发")])],1)],1):e._e(),e._v(" "),r("el-form-item",[r("el-button",{on:{click:function(t){e.nextStep(0)}}},[e._v("上一步")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:function(t){t.preventDefault(),t.stopPropagation(),e.save(t)}}},[e._v("保存")])],1)]:e._e()],2)],1)},staticRenderFns:[]};var c=r("VU/8")(m,u,!1,function(e){r("1fR8")},"data-v-2a0ab2c3",null);t.default=c.exports},zLG6:function(e,t,r){(e.exports=r("FZ+f")(!1)).push([e.i,"\n.article_pages[data-v-2a0ab2c3]{\r\n  text-align: right;\r\n  margin: 5px 0 0;\n}\n.editor-item[data-v-2a0ab2c3] {\r\n  display: -webkit-box;\r\n  display: -ms-flexbox;\r\n  display: flex;\r\n  width: 470px;\r\n  -webkit-box-pack: justify;\r\n      -ms-flex-pack: justify;\r\n          justify-content: space-between;\n}\n.switch-flex[data-v-2a0ab2c3] {\r\n  width: 700px;\n}\n.switch-flex .el-checkbox[data-v-2a0ab2c3]:nth-child(4) {\r\n  margin: 0;\n}\r\n",""])}});