webpackJsonp([118],{"6ke+":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("//Fk"),s=a.n(i),n=a("YK4W"),r=a("KEpt"),o=a("afCy"),l=a("sF3O"),c=a("0xDb"),u={name:"voteWorks",components:{customElTable:n.a,DetailCard:o.a},data:function(){return{tags:[],userListQueryFrm:{activityName:"",stageName:"",missionName:"",compositionName:"",status:"",tags:""},tableOptions:[{label:"编号",prop:"id",width:80},{label:"作品名称",prop:"title"},{label:"作品",prop:"cover",width:260,options:{type:"html"}},{label:"作品标签",prop:"city_name"},{label:"票数",prop:"tickets",width:120},{label:"智能审核状态",prop:"suggestion_cn",width:120,options:{type:"tag",prop:"aliyun_status"}},{label:"状态",prop:"status_cn",width:120,options:{type:"tag",prop:"platform_status"}},{label:"排名",prop:"ranking",width:80,sortable:!0},{label:"用户姓名",prop:"nickname",width:100},{label:"联系电话",prop:"phone",width:120},{label:"上传时间",prop:"create_time",sortable:!0},{prop:"USER_ACTION",actions:[{label:"查看评论",type:"details"},{type:"examine",options:this.getStatusBtnInfo},{type:"top",options:this.getTop},{label:"刷票",type:"brushTicket"},{label:"拉入黑名单",type:"blacklist",disableds:this.ifDisabled}]}],tableData:[],reason:"",pageIndex:1,pageSize:20,totalCount:0,tabLoading:!0,ifWorkDetails:!1,ifReason:!1,workDetails:{id:1,workType:2,workUrl:"",workName:"",workDescribe:""},activeOptions:[],stageOptions:[],worksOptions:[],activity_id:"",stageId:"",matchTypeOptions:[{label:"未审核",value:"0"},{label:"已过审",value:"1"},{label:"未过审",value:"2"}]}},created:function(){var t=this;s.a.all([this.getActiveList(),this.getData()]).then(function(){t.pageLoading=!1}).catch(function(){t.pageLoading=!1})},methods:{getTop:function(t){if(!t)return{btn:"primary",label:"置顶"};var e=1*t.top;return{btn:0===e?"primary":"danger",label:0===e?"置顶":"取消置顶"}},remoteMethod:function(t){var e=this,a={page_index:1,page_size:20,name:t};r.a.tags(a).then(function(t){e.tags=t.result})},getData:function(){var t=this;this.tabLoading=!0,r.a.list({pageIndex:this.pageIndex,pageSize:this.pageSize,activityName:this.userListQueryFrm.activityName,stageName:this.userListQueryFrm.stageName,missionName:this.userListQueryFrm.missionName,compositionName:this.userListQueryFrm.compositionName,status:this.userListQueryFrm.status,tag_id:this.userListQueryFrm.tags}).then(function(e){e.result.forEach(function(t){t.aliyun_status=2,t.tags&&t.tags.length?t.tags=t.tags.join(","):t.tags="","已过审"===t.suggestion_cn?t.aliyun_status=1:"未过审"===t.suggestion_cn&&(t.aliyun_status=0),t.platform_status-0==0?t.platform_status=3:t.platform_status-0==2&&(t.platform_status=0),1*t.type==1?t.cover='<video controls style="width:200px;" src="'+t.detail+'"></video>':1*t.type==2?t.cover='<img style="width:100px;" src="'+(t.image_small||t.cover||t.detail)+'"/>':1*t.type==5?t.cover='<audio controls src="'+t.detail+'"></audio>':t.cover='<div style="width: 200px;" v-html="'+t.detail+'"></div>',t.black-0==1&&(t.status_cn="黑名单",t.platform_status=2),t.create_time=1*t.create_time!=0?Object(c.c)(t.create_time):"--"}),t.tableData=e.result,t.totalCount=1*e.totalCount,t.tabLoading=!1}).catch(function(){t.tabLoading=!1})},getActiveList:function(){var t=this;l.a.activity.list({pageIndex:1,pageSize:1e3,status:1}).then(function(e){t.activeOptions=e.result})},getStage:function(t){var e=this,a=this.activeOptions.find(function(e){return e.activity_name===t});this.activity_id=a.id,l.a.stage.list(this.activity_id,{pageIndex:1,pageSize:1e3,status:1}).then(function(t){e.stageOptions=t.result})},getWorksList:function(t){var e=this,a=this.stageOptions.find(function(e){return e.stage_name===t});this.stageId=a.id,l.a.task.list(this.stageId,{pageIndex:1,pageSize:1e3,status:1}).then(function(t){e.worksOptions=t.result})},searchUser:function(){this.pageIndex=1,this.getData()},workPass:function(){var t=this;r.a.status(this.workDetails.id,{status:1}).then(function(){t.ifWorkDetails=!1,t.getData()})},workNoPass:function(){this.ifReason=!0},submitReason:function(){var t=this;r.a.status(this.workDetails.id,{status:2,reason:this.reason}).then(function(){t.ifReason=!1,t.ifWorkDetails=!1,t.getData()})},actionHandler:function(t,e){var a=this;if("examine"===t)this.ifWorkDetails=!0,this.workDetails.id=e.id,this.workDetails.workType=e.type-0,this.workDetails.workUrl=e.detail,this.workDetails.workName=e.title,this.workDetails.workDescribe=e.description;else if("blacklist"===t){if(e.status-0==4)return;this.$confirm("确认将 "+e.nickname+" 的作品 "+e.title+" 拉入黑名单吗？","黑名单",{dangerouslyUseHTMLString:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){r.a.black(e.id).then(function(){a.getData(),a.$message({type:"info",message:"已拉黑"})})}).catch(function(){a.$message({type:"info",message:"已取消"})})}else"details"===t?this.$router.push({name:"voteComment",params:{id:e.id}}):"top"===t?this.changeTop(e):"brushTicket"===t&&this.brushTicket(e)},brushTicket:function(t){var e=this;this.$prompt("你正在为“"+t.title+"”刷票,请输入需要刷到的票数","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(a){var i=a.value,s={activity_id:t.activity_id,composition_id:t.id,tickets:i};r.a.brushTicket(s).then(function(){e.$message({type:"success",message:"刷票成功"}),e.getData()})})},changeTop:function(t){var e=this,a=void 0;a=0==t.top?1:0,r.a.changeTop(t.id,a).then(function(){e.getData()})},getStatusBtnInfo:function(t){return{btn:"primary",label:"审核"}},ifDisabled:function(t){return!!t&&(t.black-0==1||void 0)},sizeChangeHandler:function(t){this.pageSize=t,this.pageIndex=1,this.getData()},pageChangeHandler:function(t){this.pageIndex=t,this.getData()}}},p={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container"},[a("div",{staticClass:"control-group"},[a("el-form",{attrs:{inline:!0,model:t.userListQueryFrm}},[a("el-form-item",{attrs:{label:"活动名称"}},[a("el-select",{attrs:{placeholder:"全部",clearable:""},on:{change:t.getStage},model:{value:t.userListQueryFrm.activityName,callback:function(e){t.$set(t.userListQueryFrm,"activityName",e)},expression:"userListQueryFrm.activityName"}},t._l(t.activeOptions,function(t){return a("el-option",{key:t.id,attrs:{label:t.activity_name,value:t.activity_name}})}))],1),t._v(" "),a("el-form-item",{attrs:{label:"活动阶段"}},[a("el-select",{attrs:{placeholder:"全部",clearable:""},on:{change:t.getWorksList},model:{value:t.userListQueryFrm.stageName,callback:function(e){t.$set(t.userListQueryFrm,"stageName",e)},expression:"userListQueryFrm.stageName"}},t._l(t.stageOptions,function(t){return a("el-option",{key:t.id,attrs:{label:t.stage_name,value:t.stage_name}})}))],1),t._v(" "),a("el-form-item",{attrs:{label:"任务名称"}},[a("el-select",{attrs:{placeholder:"全部",clearable:""},model:{value:t.userListQueryFrm.missionName,callback:function(e){t.$set(t.userListQueryFrm,"missionName",e)},expression:"userListQueryFrm.missionName"}},t._l(t.worksOptions,function(t){return a("el-option",{key:t.id,attrs:{label:t.mission_name,value:t.mission_name}})}))],1),t._v(" "),a("el-form-item",{attrs:{label:"作品名称"}},[a("el-input",{attrs:{placeholder:"作品名称"},model:{value:t.userListQueryFrm.compositionName,callback:function(e){t.$set(t.userListQueryFrm,"compositionName",e)},expression:"userListQueryFrm.compositionName"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"作品状态"}},[a("el-select",{attrs:{placeholder:"全部",clearable:""},model:{value:t.userListQueryFrm.status,callback:function(e){t.$set(t.userListQueryFrm,"status",e)},expression:"userListQueryFrm.status"}},t._l(t.matchTypeOptions,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),a("el-form-item",{attrs:{label:"作品标签"}},[a("el-select",{attrs:{placeholder:"全部",clearable:"",filterable:"",remote:"","remote-method":t.remoteMethod},model:{value:t.userListQueryFrm.tags,callback:function(e){t.$set(t.userListQueryFrm,"tags",e)},expression:"userListQueryFrm.tags"}},t._l(t.tags,function(t){return a("el-option",{key:t.value,attrs:{label:t.name,value:t.id}})}))],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.searchUser}},[t._v("查询")])],1)],1)],1),t._v(" "),a("custom-el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.tabLoading,expression:"tabLoading"}],attrs:{tableData:t.tableData,tableOptions:t.tableOptions,total:t.totalCount},on:{action:t.actionHandler,"size-change":t.sizeChangeHandler,"page-change":t.pageChangeHandler},model:{value:t.pageIndex,callback:function(e){t.pageIndex=e},expression:"pageIndex"}}),t._v(" "),t.workDetails.workName&&t.workDetails.workUrl?a("el-dialog",{attrs:{title:"作品详情",visible:t.ifWorkDetails},on:{"update:visible":function(e){t.ifWorkDetails=e}}},[a("el-dialog",{attrs:{width:"30%",title:"原因",visible:t.ifReason,"append-to-body":""},on:{"update:visible":function(e){t.ifReason=e}}},[a("el-input",{staticStyle:{"margin-botton":"20px"},attrs:{placeholder:"请输入未过审原因"},model:{value:t.reason,callback:function(e){t.reason=e},expression:"reason"}}),t._v(" "),a("div",{staticClass:"work-btn"},[a("el-button",{staticStyle:{margin:"auto"},attrs:{type:"primary"},on:{click:t.submitReason}},[t._v("提交")])],1)],1),t._v(" "),a("div",{staticClass:"item-detail-content"},[a("p",[t._v("作品名称: "+t._s(t.workDetails.workName))]),t._v(" "),a("p",[t._v("描述: "+t._s(t.workDetails.workDescribe))]),t._v(" "),a("div",{staticClass:"workItem"},[a("p",[t._v("作品详情:")]),t._v(" "),1==t.workDetails.workType&&t.ifWorkDetails?a("video",{staticStyle:{"margin-left":"20px"},attrs:{src:t.workDetails.workUrl,controls:"controls",width:"600px",height:"380px"}}):2==t.workDetails.workType&&t.ifWorkDetails?a("div",{staticClass:"workImg"},[a("img",{staticStyle:{"max-width":"540px","margin-left":"20px"},attrs:{src:t.workDetails.workUrl,alt:"workDetails"}})]):5==t.workDetails.workType&&t.ifWorkDetails?a("audio",{staticStyle:{"margin-left":"20px"},attrs:{src:t.workDetails.workUrl,controls:"controls"}}):t._e()])]),t._v(" "),a("div",{staticClass:"work-btn"},[a("el-button",{attrs:{type:"danger"},on:{click:t.workNoPass}},[t._v("审核未过")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.workPass}},[t._v("审核通过")])],1)],1):t._e()],1)},staticRenderFns:[]};var m=a("VU/8")(u,p,!1,function(t){a("d1Ze")},"data-v-29b7df7a",null);e.default=m.exports},HzIK:function(t,e,a){(t.exports=a("FZ+f")(!1)).push([t.i,"\n.workItem[data-v-29b7df7a] {\r\n  display: -webkit-box;\r\n  display: -ms-flexbox;\r\n  display: flex;\n}\n.workImg[data-v-29b7df7a] {\r\n  width: 540px;\r\n  margin: 14px 0 0;\n}\n.workImg > img[data-v-29b7df7a] {\r\n  display: inline-block;\r\n  height: auto;\r\n  max-width: 100%;\n}\n.work-btn[data-v-29b7df7a] {\r\n  width: 40%;\r\n  display: -webkit-box;\r\n  display: -ms-flexbox;\r\n  display: flex;\r\n  margin: 30px auto 0;\r\n  -webkit-box-pack: justify;\r\n      -ms-flex-pack: justify;\r\n          justify-content: space-between;\n}\r\n",""])},d1Ze:function(t,e,a){var i=a("HzIK");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);a("rjj0")("02158842",i,!0)}});