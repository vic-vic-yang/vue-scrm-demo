webpackJsonp([6],{"3wh2":function(e,t,i){(e.exports=i("FZ+f")(!1)).push([e.i,"\n.upload_content[data-v-536caf0e] {\n  width: 90%;\n  height: 600px;\n  margin: 0 auto;\n}\n.upload-container[data-v-536caf0e] {\n  position: relative;\n  width: 100%;\n  line-height: 0;\n}\n.single-image__uploader[data-v-536caf0e] {\n  width: 126px;\n  height: 126px;\n}\n.single-image__uploader .el-upload[data-v-536caf0e] {\n  position: relative;\n  min-width: 126px;\n  min-height: 126px;\n  border: 1px dashed #d9d9d9;\n  border-radius: 6px;\n  cursor: pointer;\n  overflow: hidden;\n}\n.single-image__uploader .el-upload[data-v-536caf0e]:hover {\n  border-color: #409EFF;\n}\n.single-uploader__icon[data-v-536caf0e] {\n  font-size: 28px;\n  color: #8c939d;\n  width: 126px;\n  height: 126px;\n  line-height: 126px;\n  text-align: center;\n}\n.preview-img[data-v-536caf0e] {\n  display: block;\n  width: 100%;\n  height: 100%;\n}\n.preview-img + a.del[data-v-536caf0e] {\n  position: absolute;\n  top: 0;\n  right: 0;\n  width: 20px;\n  height: 20px;\n  background: rgba(0, 0, 0, 0.6);\n  cursor: pointer;\n}\n.preview-img + a.del > i[data-v-536caf0e] {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    text-align: center;\n    -webkit-transform: translate(-50%, -50%);\n            transform: translate(-50%, -50%);\n    color: #ffffff;\n    font-size: 16px;\n}\n.dragArea[data-v-536caf0e] {\n  display: inline;\n}\n.commodity-pic-ul[data-v-536caf0e] {\n  display: inline-block;\n}\n.commodity-pic-sl[data-v-536caf0e] {\n  margin-bottom: 5px;\n}\n.commodity-pic-li[data-v-536caf0e] {\n  position: relative;\n  margin-left: 3px;\n}\n.progress[data-v-536caf0e] {\n  position: absolute;\n  left: 0;\n  top: 50%;\n}\n.commodity-pic .single-image__uploader .el-upload[data-v-536caf0e], .commodity-pic-sl[data-v-536caf0e], .el-upload--text[data-v-536caf0e] {\n  display: inline-block;\n  vertical-align: middle;\n  width: 126px;\n  height: 126px;\n}\n.el-upload--text img[data-v-536caf0e] {\n  -o-object-fit: cover;\n     object-fit: cover;\n}\n.el-upload__input[data-v-536caf0e] {\n  visibility: hidden;\n}\n.single-image-dis[data-v-536caf0e] {\n  position: relative;\n}\n.single-image-dis .el-upload__input[data-v-536caf0e] {\n  display: none;\n}\n.cover[data-v-536caf0e] {\n  width: auto;\n  height: auto;\n  text-align: center;\n  border-top: 1px solid #eeeeee;\n  border-bottom: 1px solid #eeeeee;\n}\n.cover img[data-v-536caf0e] {\n    padding: 20px 0 15px;\n    -o-object-fit: cover;\n       object-fit: cover;\n}\n",""])},"8j1o":function(e,t,i){"use strict";var o=i("//Fk"),a=i.n(o),n=i("zL8q"),s=(i.n(n),i("gyMJ"));t.a={list:function(e){return s.a.get("/integral/v1/goods/goods",{params:e}).then(function(e){return e.data})},del:function(e){return s.a.delete("/integral/v1/goods/goods/"+e,{autoShowMessage:!0})},status:function(e){return s.a.put("/integral/v1/goods/goods/"+e.id+"/status/"+e.status,{autoShowMessage:!0,showMessageType:"put"})},get:function(e){return s.a.get("/integral/v1/goods/goods/"+e).then(function(e){return e.data})},add:function(e){return s.a.post("/integral/v1/goods/goods",e,{autoShowMessage:!0})},edit:function(e){return s.a.put("/integral/v1/goods/goods/"+e.id,e,{autoShowMessage:!0,showMessageType:"put"})},upload:function(e,t){if(!t)return Object(n.Message)({message:"上传文件不能为空",type:"error",duration:3e3}),a.a.reject(!1);var i=new FormData;return i.append("goods_id",e),i.append("file",t),s.a.post("/integral/v1/goods/goods/import-card-number",i,{headers:{"Content-Type":"multipart/form-data"},timeout:3e4}).then(function(e){return 200===e.code?e.data:a.a.reject(e)})}}},QJ2D:function(e,t,i){(e.exports=i("FZ+f")(!1)).push([e.i,"\n.limit-count__input[data-v-70fcee7a] {\n  width: 66px;\n}\n.limit-count__input > input[data-v-70fcee7a] {\n  padding: 0 10px;\n  text-align: center;\n}\nheader[data-v-70fcee7a] {\n  margin-bottom: 20px;\n  background-color: #f1f1f1;\n  border-radius: 5px;\n  padding: 0.5rem 1rem;\n  font-size: 15px;\n  color: #999;\n}\n",""])},TYdj:function(e,t,i){var o=i("3wh2");"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);i("rjj0")("609e3aa8",o,!0)},ct4t:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i("woOf"),a=i.n(o),n=i("M4fF"),s=i.n(n),l=i("uzBN"),r=i("YZ0n"),c=i("DAYN"),d={props:["pic"],data:function(){return{picLists:this.pic||[],edit_pic:{is_edit:!1,id:0,file_path:""},dialogVisible:!1,dialogVisibleImg:!1,dialogVisibleImgSrc:"",option:{img:"",outputSize:1,outputType:"jpeg",autoCrop:!0,autoCropWidth:800,autoCropHeight:620,fixedNumber:[4,3],fixedBox:!1,full:!1,canMove:!0,original:!1,canMoveBox:!0,info:!0,fixed:!0,high:!0},file:"",fileName:"",fileSize:"",fileType:"",showImageDel:!1,isUploadLoading:!1,uploadPercent:0,is_end:!1}},components:{draggable:i.n(c).a,VueCropper:r.VueCropper},watch:{pic:function(e){this.picLists=this.pic},picLists:{immediate:!0,deep:!0,handler:function(e){e&&this.$emit("get_pic",e)}}},methods:{findUploadPosition:function(e){return s.a.findIndex(e,function(e){return!e.id&&!e.file_path})},getPicData:function(e){return e=s.a.cloneDeep(e),s.a.filter(e,function(e){return e.id&&e.file_path})},add_img:function(){this.$refs.inputer.click()},edit_img:function(e,t){this.dialogVisibleImg=!1,this.dialogVisibleImgSrc=e.file_path,this.dialogVisibleImg=!0},delImageHandler:function(e,t){this.picLists.splice(t,1),this.$emit("get_pic",this.picLists)},new_upload_img:function(e){var t=this,i=e.target.files[0],o=new FileReader;this.dialogVisible=!1,this.fileName=i.name,o.readAsDataURL(i),o.onload=function(e){t.dialogVisible=!0,t.option.img=this.result},a()(t.edit_pic,{is_edit:!1}),t.picLists.push({id:0}),e.target.value=""},edit_upload_img:function(e,t){var i=this;this.dialogVisible=!1;var o=t.target.files[0],n=new FileReader;this.fileName=o.name,n.readAsDataURL(o),n.onload=function(e){i.dialogVisible=!0,i.option.img=this.result},a()(this.edit_pic,{is_edit:!0,id:e.id,file_path:e.file_path}),t.target.value=""},cancel_dialogVisible:function(){this.dialogVisible=!this.dialogVisible,this.delete_picl_list(),this.is_send=!1},determine_img:function(){var e=this;this.dialogVisible=!this.dialogVisible,this.is_send=!0,this.edit_pic.is_edit||this.picLists.push({id:0}),this.$refs.cropper.startCrop(),this.$refs.cropper.getCropData(function(t){var i=e.convertBase64UrlToBlob(t,e.fileName);e.uploadAction(i)})},handleClose:function(){this.is_end||this.delete_picl_list()},uploadAction:function(e){var t=this;this.isUploadLoading=!0,l.a.img(e,"file",function(e){t.uploadPercent=Math.min(99,Math.floor(100*e.loaded/e.total))}).then(function(e){t.set_pic_lists(e.id,e.url),t.isUploadLoading=!1}).catch(function(){t.isUploadLoading=!1,t.uploadPercent=0,t.delete_picl_list()})},set_pic_lists:function(e,t){var i=this;this.picLists.map(function(o){i.edit_pic.is_edit?o.id===i.edit_pic.id&&(o.id=e,o.file_path=t):0===o.id&&(o.id=e,o.file_path=t)}),this.$emit("get_pic",this.picLists)},delete_picl_list:function(){var e=this;this.picLists.map(function(t,i){0===t.id&&e.picLists.splice(i,1)})},convertBase64UrlToBlob:function(e,t){for(var i=e.split(","),o=i[0].match(/:(.*?);/)[1],a=atob(i[1]),n=a.length,s=new Uint8Array(n);n--;)s[n]=a.charCodeAt(n);return new File([s],t,{type:o})}}},p={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"upload-container"},[i("div",{staticClass:"el-upload-list el-upload-list--picture-card commodity-pic-ul"},[i("draggable",{staticClass:"dragArea",attrs:{list:e.picLists,options:{group:"article"}}},e._l(e.picLists,function(t,o){return e.picLists.length>0?i("div",{key:o,staticClass:"upload-container commodity-pic-sl commodity-pic-li",on:{click:function(i){e.edit_img(t,o)}}},[i("div",{staticClass:"single-image__uploader single-image-dis"},[i("div",{staticClass:"el-upload el-upload--text"},[t?[i("img",{staticClass:"preview-img",attrs:{src:t.file_path},on:{mouseover:function(t){e.showImageDel=!0},mouseout:function(t){e.showImageDel=!1}}}),e._v(" "),i("a",{directives:[{name:"show",rawName:"v-show",value:e.showImageDel,expression:"showImageDel"}],staticClass:"del",on:{click:function(i){i.stopPropagation(),i.preventDefault(),e.delImageHandler(t,o)},mouseover:function(t){e.showImageDel=!0},mouseout:function(t){e.showImageDel=!1}}},[i("i",{staticClass:"el-icon-close"})])]:e._e()],2),e._v(" "),i("input",{ref:"referenceUpload"+o,refInFor:!0,staticClass:"el-upload__input",attrs:{type:"file",id:"referenceUpload"+o,name:"file",accept:"image/gif,image/jpeg,image/jpg,image/png",multiple:""},on:{change:function(i){e.edit_upload_img(t,i)}}})]),e._v(" "),0===t.id||t.id===e.edit_pic.id?i("div",{staticClass:"progress"},[i("el-progress",{directives:[{name:"show",rawName:"v-show",value:e.isUploadLoading,expression:"isUploadLoading"}],attrs:{type:"circle",percentage:e.uploadPercent}})],1):e._e()]):e._e()})),e._v(" "),e.picLists.length<15?i("div",{staticClass:"upload-container commodity-pic-sl",on:{click:e.add_img}},[i("div",{staticClass:"single-image__uploader"},[i("div",{staticClass:"el-upload el-upload--text"},[i("i",{staticClass:"el-icon-plus single-uploader__icon"}),e._v(" "),i("input",{ref:"inputer",staticClass:"el-upload__input",attrs:{type:"file",name:"file",id:"inputer",accept:"image/gif,image/jpeg,image/jpg,image/png",multiple:""},on:{change:e.new_upload_img}})])])]):e._e()],1),e._v(" "),i("el-dialog",{attrs:{title:"裁剪图片",visible:e.dialogVisible,top:"10vh",width:"80%","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t},close:e.handleClose}},[i("p",[e._v("提示：在裁剪区域滚动滚轮可以缩放图片")]),e._v(" "),i("div",{staticClass:"upload_content"},[i("vueCropper",{ref:"cropper",attrs:{img:e.option.img,outputSize:e.option.outputSize,outputType:e.option.outputType,autoCrop:e.option.autoCrop,fixedNumber:e.option.fixedNumber,fixedBox:e.option.fixedBox,autoCropWidth:e.option.autoCropWidth,autoCropHeight:e.option.autoCropHeight,full:e.option.full,canMove:e.option.canMove,original:e.option.original,canMoveBox:e.option.canMoveBox,info:e.option.info,fixed:e.option.fixed,high:e.option.high}})],1),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.cancel_dialogVisible()}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.determine_img()}}},[e._v("确 定")])],1)]),e._v(" "),i("el-dialog",{attrs:{visible:e.dialogVisibleImg,title:"图片预览",top:"10vh",width:"","close-on-click-modal":!0},on:{"update:visible":function(t){e.dialogVisibleImg=t},close:e.handleClose}},[i("div",{staticClass:"cover"},[i("img",{attrs:{src:e.dialogVisibleImgSrc,alt:""}})]),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialogVisibleImg=!1}}},[e._v("确 定")])],1)])],1)},staticRenderFns:[]};var m=i("VU/8")(d,p,!1,function(e){i("TYdj")},"data-v-536caf0e",null).exports,u=i("8j1o"),g={name:"add",components:{imgCropper:m},data:function(){return{isUploadLoading:!1,pageLoading:!0,action:this.$route.params.id?"modify":"add",commodityFrm:{showPrice:!0,id:this.$route.params.id||0,type:"",name:"",desc:"",pic:[],price:"",status:1,integral:"",sort:0,changeCode:1,need_contact:1},frmRules:{changeCode:[{required:!0,message:"请选择商品类型"}],type:[{required:!0,message:"请选择商品类型"}],name:[{required:!0,message:"请填写商品名称"}],desc:[{required:!0,message:"商品描述"}],pic:[{required:!0,message:"请填上传商品图片"}],price:[{required:!0,message:"请填写商品价格"}],integral:[{required:!0,message:"请填写商品积分价格"}],total_num:[{required:!0,message:"请填写库存"}],sort:[{required:!0,message:"请填写权重值"}],status:[{required:!0,message:"请选择上架时间"}]},commodityTypeOptions:[{value:1,label:"实物商品"},{value:2,label:"电子卡券"}]}},created:function(){this.getDetail()},methods:{uploadError:function(e){this.isUploadLoading.close(),this.$message({message:e&&e.message?e.message:"导入失败",type:"error"})},uploadSuccess:function(e){this.isUploadLoading.close(),this.$message({message:"导入成功",type:"success"})},uploadAction:function(e){this.isUploadLoading.close(),this.file=e.file},beforeUpload:function(){this.isUploadLoading=this.$loading({lock:!0,text:"正在导入",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"})},getDetail:function(){var e=this;if("add"===this.action)return this.pageLoading=!1;u.a.get(this.commodityFrm.id).then(function(t){t.total_num=1*t.total_num-1*t.sell_num,t.pic=t.pic||[],e.commodityFrm=s.a.assign({},e.commodityFrm,t),e.pageLoading=!1}).catch(function(){e.pageLoading=!1})},save:function(){var e=this;this.$refs.commodityFrm.validate(function(t){if(t){var i=1*e.commodityFrm.sell_num||0,o=a()({},e.commodityFrm);o.pic=o.pic.map(function(e){return e.id}).join(","),o.total_num=1*e.commodityFrm.total_num+i,("modify"===e.action?u.a.edit(o):u.a.add(o)).then(function(t){console.log(t),u.a.upload(t.data.id,e.file).then(e.uploadSuccess).catch(e.uploadError),e.$router.back()})}})},get_pic:function(e){this.commodityFrm.pic=e}}},f={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.pageLoading,expression:"pageLoading"}],staticClass:"app-container"},[i("el-form",{ref:"commodityFrm",staticClass:"commodity-edit__form",attrs:{model:e.commodityFrm,rules:e.frmRules,"label-width":"120px"}},[i("el-form-item",{attrs:{prop:"type",label:"商品类型"}},[i("el-select",{attrs:{placeholder:"请选择商品类型"},model:{value:e.commodityFrm.type,callback:function(t){e.$set(e.commodityFrm,"type",t)},expression:"commodityFrm.type"}},e._l(e.commodityTypeOptions,function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),i("header",[e._v("基本信息")]),e._v(" "),i("el-form-item",{attrs:{prop:"name",label:"商品名称"}},[i("el-input",{attrs:{placeholder:"请输入商品名称",maxlength:40,name:"name",clearable:!0},model:{value:e.commodityFrm.name,callback:function(t){e.$set(e.commodityFrm,"name",t)},expression:"commodityFrm.name"}})],1),e._v(" "),i("el-form-item",{attrs:{prop:"pic",label:"商品图片"}},[i("img-cropper",{attrs:{pic:e.commodityFrm.pic},on:{get_pic:e.get_pic}}),e._v(" "),i("small",{staticClass:"text-999"},[e._v("建议尺寸：800*620像素，你可以拖拽图片调整顺序，最多上传15张")])],1),e._v(" "),i("el-form-item",{attrs:{prop:"desc",label:"商品描述"}},[i("el-input",{attrs:{type:"textarea",rows:4,placeholder:"请输入商品描述",name:"desc",clearable:!0},model:{value:e.commodityFrm.desc,callback:function(t){e.$set(e.commodityFrm,"desc",t)},expression:"commodityFrm.desc"}})],1),e._v(" "),i("el-form-item",{attrs:{prop:"price",label:"商品价格"}},[i("el-input-number",{attrs:{min:0,name:"person_num"},model:{value:e.commodityFrm.price,callback:function(t){e.$set(e.commodityFrm,"price",t)},expression:"commodityFrm.price"}}),e._v(" "),i("span",{staticClass:"ml-5 text-666"},[e._v("元")]),e._v(" "),i("el-switch",{staticStyle:{"margin-left":"10px"},attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},model:{value:e.commodityFrm.showPrice,callback:function(t){e.$set(e.commodityFrm,"showPrice",t)},expression:"commodityFrm.showPrice"}}),e._v(" "),i("span",{staticClass:"ml-5 text-666"},[e._v(e._s(e.commodityFrm.showPrice?"显示":"不显示"))])],1),e._v(" "),i("el-form-item",{attrs:{prop:"integral",label:"商品积分价格"}},[i("el-input-number",{attrs:{min:0,name:"integral"},model:{value:e.commodityFrm.integral,callback:function(t){e.$set(e.commodityFrm,"integral",t)},expression:"commodityFrm.integral"}}),e._v(" "),i("span",{staticClass:"ml-5 text-666"},[e._v("元")])],1),e._v(" "),i("el-form-item",{attrs:{prop:"total_num",label:"库存"}},[i("el-input-number",{attrs:{min:0,name:"total_num"},model:{value:e.commodityFrm.total_num,callback:function(t){e.$set(e.commodityFrm,"total_num",t)},expression:"commodityFrm.total_num"}}),e._v(" "),i("span",{staticClass:"ml-5 text-666"},[e._v("件")]),e._v(" "),"modify"==e.action?i("small",{staticClass:"text-999",staticStyle:{"margin-left":"40px"}},[e._v("已兑换 "+e._s(e.commodityFrm.sell_num)+" 件")]):e._e()],1),e._v(" "),i("el-form-item",{attrs:{prop:"sort",label:"权重值"}},[i("el-input-number",{attrs:{min:0,name:"sort"},model:{value:e.commodityFrm.sort,callback:function(t){e.$set(e.commodityFrm,"sort",t)},expression:"commodityFrm.sort"}}),e._v(" "),i("small",{staticClass:"text-999",staticStyle:{"margin-left":"50px"}},[e._v("（0-1000）商品权重值越高，展示顺序越靠前")])],1),e._v(" "),i("el-form-item",{attrs:{prop:"changeCode",label:"兑换码"}},[i("el-radio-group",{model:{value:e.commodityFrm.changeCode,callback:function(t){e.$set(e.commodityFrm,"changeCode",t)},expression:"commodityFrm.changeCode"}},[i("el-radio",{attrs:{label:1}},[e._v("系统自动生成")]),e._v(" "),i("el-radio",{attrs:{label:2}},[e._v("批量导入")])],1),e._v(" "),2===e.commodityFrm.changeCode?i("el-upload",{staticStyle:{"text-align":"left","margin-top":"15px"},attrs:{action:"/api/v1/quiz/question/item/import",name:"qsFile",accept:".xls,.xlsx,.xlsm,.xltx,.xltm,.xlsb,.xlam,.csv","http-request":e.uploadAction,"before-upload":e.beforeUpload,"on-success":e.uploadSuccess,"on-error":e.uploadError,data:{groupId:1},"with-credentials":!0,"show-file-list":!1}},[i("el-button",{attrs:{type:"primary"}},[i("i",{staticClass:"el-icon-uploadmr-5"}),e._v("导入")])],1):e._e(),e._v(" "),2===e.commodityFrm.changeCode?i("p",[e._v("请上传csv格式表格或xlsx格式表格，一列一个码，"),i("a",{staticStyle:{"text-decoration":"underline"},attrs:{href:"/static/兑换码格式.xlsx"}},[e._v("点击下载格式文件")])]):e._e()],1),e._v(" "),i("header",[e._v("其他信息")]),e._v(" "),i("el-form-item",{attrs:{prop:"status",label:"上架时间"}},[i("el-radio-group",{model:{value:e.commodityFrm.status,callback:function(t){e.$set(e.commodityFrm,"status",t)},expression:"commodityFrm.status"}},[i("el-radio",{attrs:{label:1}},[e._v("立即上架")]),e._v(" "),i("el-radio",{attrs:{label:2}},[e._v("暂不上架")])],1)],1),e._v(" "),i("el-form-item",{attrs:{prop:"need_contact",label:"用户填写手机号","label-width":"auto"}},[i("el-checkbox",{attrs:{"true-label":1,"false-label":0,name:"need_contact"},model:{value:e.commodityFrm.need_contact,callback:function(t){e.$set(e.commodityFrm,"need_contact",t)},expression:"commodityFrm.need_contact"}})],1),e._v(" "),i("el-form-item",[i("el-button",{on:{click:function(t){t.preventDefault(),t.stopPropagation(),e.$router.back()}}},[e._v("取消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(t){t.preventDefault(),t.stopPropagation(),e.save(t)}}},[e._v("保存")])],1)],1)],1)},staticRenderFns:[]};var v=i("VU/8")(g,f,!1,function(e){i("gC+I")},"data-v-70fcee7a",null);t.default=v.exports},"gC+I":function(e,t,i){var o=i("QJ2D");"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);i("rjj0")("9a7ea8f0",o,!0)}});