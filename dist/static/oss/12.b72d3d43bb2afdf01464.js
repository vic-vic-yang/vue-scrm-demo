webpackJsonp([12],{bAOo:function(e,t,a){(e.exports=a("FZ+f")(!1)).push([e.i,"\n.delete-audio[data-v-fc669ec4] {\n  display: inline-block;\n  float: right;\n  margin-right: 10px;\n}\n.delete-audio .el-icon-error[data-v-fc669ec4] {\n    font-size: 20px;\n    vertical-align: middle;\n    cursor: pointer;\n}\n.header-tabs[data-v-fc669ec4] {\n  width: 150px;\n  border: 1px solid #409eff;\n  border-radius: 5px;\n  margin: 15px 0 20px;\n}\n.header-tabs .items[data-v-fc669ec4] {\n    display: inline-block;\n    width: 50%;\n    cursor: pointer;\n    text-align: center;\n    padding: 5px 0;\n}\n.header-tabs .items.active[data-v-fc669ec4] {\n      background: #409eff;\n      color: #fff;\n}\n.chapter-content[data-v-fc669ec4] {\n  width: 90%;\n  margin: 0 auto 50px;\n}\n.chapter-content .chapter-item[data-v-fc669ec4] {\n    border-bottom: 1px solid #eee;\n    padding: 15px;\n    display: -webkit-box;\n    display: -ms-flexbox;\n    display: flex;\n    -webkit-box-pack: justify;\n        -ms-flex-pack: justify;\n            justify-content: space-between;\n    -webkit-box-align: center;\n        -ms-flex-align: center;\n            align-items: center;\n}\n.chapter-content .chapter-item .icon[data-v-fc669ec4] {\n      margin-right: 15px;\n}\n.chapter-content .chapter-item .icon i[data-v-fc669ec4] {\n        font-size: 16px;\n        cursor: pointer;\n}\n.chapter-content .chapter-item .icon .upload[data-v-fc669ec4] {\n        display: inline-block;\n        margin-right: 10px;\n}\n",""])},moMb:function(e,t,a){var i=a("bAOo");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);a("rjj0")("86e27504",i,!0)},xMM3:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("woOf"),n=a.n(i),r=a("uzBN"),o=a("LiIs"),l=a("M4fF"),s=a.n(l),p=a("mtWM"),c=a.n(p),d={name:"editor",data:function(){return{pageLoading:!0,action:this.$route.query.isAdd?"add":"modify",type:0,interpretationFrm:{id:this.$route.params.id||0,book_id:this.$route.query.id||0,explain_name:"",book_name:"",audio_id:0,book_explain:"",remarks:""},chapter:[{id:0,name:"第一节",isEditor:!1,chapter_explain:"",remarks:""}],frmRules:{explain_name:[{required:!0,message:"请输入解读人"}],book_explain:[{required:!0,message:"请上传解读音频"}],remarks:[{required:!0,message:"请输入文稿"}]},interpretationTypeOptions:[{value:0,label:"整书",isTrue:!0},{value:1,label:"章节",isTrue:!1}],dialogExplain:!1,dialogRemarks:!1,selectChapter:{id:"",chapter_explain:"",remarks:""},uploadData:null,client:null,uploader:""}},created:function(){this.getDetail()},methods:{getDetail:function(){var e=this;if(this.pageLoading=!0,"add"===this.action)return this.pageLoading=!1;o.a.get({id:this.interpretationFrm.id}).then(function(t){e.interpretationFrm=s.a.assign({},e.interpretationFrm,t.data),e.interpretationFrm.audio_id=t.data.yrUploadFile[0].id,e.interpretationFrm.book_explain=t.data.yrUploadFile[0].file_path,e.pageLoading=!1})},tabsHandler:function(e){e.isTrue&&(this.type=e.value)},uploadExplain:function(e){this.selectChapter.id=e.id,this.dialogExplain=!0},editorRemarks:function(e){this.selectChapter.id=e.id,this.dialogRemarks=!0},chapter_remarks:function(){var e=this;""!==this.selectChapter.remarks&&this.chapter.amp(function(t){t.id===e.selectChapter.id&&(t.remarks=e.selectChapter.remarks)}),this.dialogRemarks=!1},chapterExplain:function(){var e=this;""!==this.selectChapter.chapter_explain?(this.chapter.amp(function(t){t.id===e.selectChapter.id&&(t.chapter_explain=e.selectChapter.chapter_explain)}),this.dialogExplain=!1):this.$message({type:"info",message:"还未上传成功"})},getWebUpload:function(e,t){var a=this;r.a.webUpload().then(function(i){a.uploadData=i.data,a.sendWebUpload(e,t)})},sendWebUpload:function(e,t){var a=this,i=new FormData,n=this.uploadData,r=n.dir+t;i.append("OSSAccessKeyId",n.accessid),i.append("policy",n.policy),i.append("signature",n.signature),i.append("key",r),i.append("success_action_status","200"),i.append("callback",n.callback),i.append("name",(new Date).getTime()+"_"+t),i.append("file",e),c.a.post(n.host,i).then(function(e){"Ok"===e.data.Status?(a.$message({type:"success",message:"上传成功"}),a.interpretationFrm.audio_id=n.fileId,a.interpretationFrm.book_explain=n.host+"/"+r):a.$message({type:"info",message:"上传失败"})}).catch(function(){a.$message({type:"info",message:"上传失败"})})},uploadAction:function(e){var t=e.file.name,a=t.lastIndexOf(".");".mp3"===t.substring(a,t.length).toLowerCase()&&this.getWebUpload(e.file,t)},uploadChapterAction:function(e){var t=this,a=e.file.name,i=a.lastIndexOf(".");".mp3"===a.substring(i,a.length).toLowerCase()?r.a.audio(e.file,"file",function(e){}).then(function(e){t.selectChapter.chapter_explain=e.url}).catch(function(){t.selectChapter.chapter_explain=""}):this.$message({type:"info",message:"只能上传“mp3”格式音频文件, 请重新选择附件上传"})},convertBase64UrlToBlob:function(e,t){for(var a=e.split(","),i=a[0].match(/:(.*?);/)[1],n=atob(a[1]),r=n.length,o=new Uint8Array(r);r--;)o[r]=n.charCodeAt(r);return new File([o],t,{type:i})},restAudio:function(){this.interpretationFrm.book_explain=""},save:function(){var e=this;this.$refs.interpretationFrm.validate(function(t){if(t){var a=n()({},e.interpretationFrm),i=(s=(l=a).book_id,p=l.audio_id,{book_id:s,explain_name:l.explain_name,audio_id:p,remarks:l.remarks});"modify"===e.action&&(i.id=a.id);var r={book_explain:i};("modify"===e.action?o.a.editor(r):o.a.add(r)).then(function(){"add"===e.action?e.$router.go(-2):e.$router.back()})}var l,s,p})},cancel:function(){"add"===this.action?this.$router.go(-2):this.$router.back()}}},m={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.pageLoading,expression:"pageLoading"}],staticClass:"app-container"},[a("el-row",[a("el-col",{attrs:{span:4,offset:10}},[a("div",{staticClass:"header-tabs"},e._l(e.interpretationTypeOptions,function(t){return a("div",{key:t.value,class:["items",e.type==t.value?"active":""],attrs:{span:12},on:{click:function(a){e.tabsHandler(t)}}},[e._v("\n          "+e._s(t.label)+"\n        ")])}))])],1),e._v(" "),a("el-form",{ref:"interpretationFrm",staticClass:"commodity-edit__form",attrs:{model:e.interpretationFrm,rules:e.frmRules,"label-width":"100px"}},[0===e.type?[a("el-form-item",{attrs:{prop:"book_id",label:"书籍id"}},[a("el-input",{attrs:{placeholder:"书籍名称",maxlength:40,name:"book_id",disabled:!0,clearable:!1},model:{value:e.interpretationFrm.book_id,callback:function(t){e.$set(e.interpretationFrm,"book_id",t)},expression:"interpretationFrm.book_id"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"book_name",label:"书籍名称"}},[a("el-input",{attrs:{placeholder:"书籍名称",maxlength:40,name:"book_name",disabled:!0,clearable:!1},model:{value:e.interpretationFrm.book_name,callback:function(t){e.$set(e.interpretationFrm,"book_name",t)},expression:"interpretationFrm.book_name"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"explain_name",label:"解读人"}},[a("el-input",{attrs:{placeholder:"解读人",maxlength:40,name:"explain_name",clearable:!1},model:{value:e.interpretationFrm.explain_name,callback:function(t){e.$set(e.interpretationFrm,"explain_name",t)},expression:"interpretationFrm.explain_name"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"book_explain",label:"解读音频"}},[e.interpretationFrm.book_explain?e._e():[a("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:"$store.state.uploadImgUrl","show-file-list":!0,multiple:!1,limit:1,accept:"audio/mpeg","http-request":e.uploadAction}},[a("el-button",{attrs:{size:"small",type:"primary"}},[e._v("解读音频")])],1)],e._v(" "),e.interpretationFrm.book_explain?[a("audio",{staticStyle:{width:"90%",height:"40px","vertical-align":"middle",outline:"none"},attrs:{src:e.interpretationFrm.book_explain,controls:""}}),e._v(" "),a("span",{staticClass:"delete-audio",on:{click:e.restAudio}},[a("i",{staticClass:"el-icon-error"})])]:e._e()],2),e._v(" "),a("el-form-item",{attrs:{prop:"remarks",label:"文稿"}},[a("el-input",{attrs:{type:"textarea",placeholder:"文稿",maxlength:40,rows:"8",name:"remarks",clearable:!0},model:{value:e.interpretationFrm.remarks,callback:function(t){e.$set(e.interpretationFrm,"remarks",t)},expression:"interpretationFrm.remarks"}})],1)]:2===e.type?[a("div",{staticClass:"chapter-content"},e._l(e.chapter,function(t,i){return a("div",{key:i,staticClass:"chapter-item"},[a("div",{staticClass:"name"},[e._v(e._s(t.name))]),e._v(" "),a("div",{staticClass:"icon"},[a("el-tooltip",{attrs:{placement:"top",content:"上传解读"}},[a("a",{staticClass:"upload",on:{click:function(a){e.uploadExplain(t)}}},[a("i",{staticClass:"el-icon-upload"})])]),e._v(" "),a("el-tooltip",{attrs:{placement:"top",content:"修改文稿"}},[a("a",{on:{click:function(a){e.editorRemarks(t)}}},[a("i",{staticClass:"el-icon-tickets"})])])],1)])}))]:e._e(),e._v(" "),a("el-form-item",[a("el-button",{on:{click:function(t){t.preventDefault(),t.stopPropagation(),e.cancel(t)}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){t.preventDefault(),t.stopPropagation(),e.save(t)}}},[e._v("保存")])],1)],2),e._v(" "),a("el-dialog",{attrs:{title:"解读",visible:e.dialogExplain,width:"45%"},on:{"update:visible":function(t){e.dialogExplain=t}}},[e.selectChapter.chapter_explain?e._e():[a("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:"$store.state.uploadImgUrl","show-file-list":!0,multiple:!1,limit:1,accept:"audio/mpeg","http-request":e.uploadChapterAction}},[a("el-button",{attrs:{size:"small",type:"primary"}},[e._v("新增解读音频")])],1)],e._v(" "),e.selectChapter.chapter_explain?[a("audio",{staticStyle:{width:"90%",height:"40px","vertical-align":"middle",outline:"none"},attrs:{src:e.selectChapter.chapter_explain,controls:""}}),e._v(" "),a("span",{staticClass:"delete-audio",on:{click:e.restAudio}},[a("i",{staticClass:"el-icon-error"})])]:e._e(),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogExplain=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.chapterExplain}},[e._v("确 定")])],1)],2),e._v(" "),a("el-dialog",{attrs:{title:"文稿",visible:e.dialogRemarks,width:"45%"},on:{"update:visible":function(t){e.dialogRemarks=t}}},[a("el-input",{attrs:{type:"textarea",placeholder:"文稿",maxlength:40,rows:"10",name:"remarks",clearable:!0},model:{value:e.selectChapter.remarks,callback:function(t){e.$set(e.selectChapter,"remarks",t)},expression:"selectChapter.remarks"}}),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogRemarks=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.chapter_remarks}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var u=a("VU/8")(d,m,!1,function(e){a("moMb")},"data-v-fc669ec4",null);t.default=u.exports}});