webpackJsonp([52],{IfBx:function(t,e,a){var i=a("oNQQ");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);a("rjj0")("277a75ea",i,!0)},MN6w:function(t,e,a){"use strict";var i=a("gyMJ");e.a={list:function(t){return i.a.get("/mission/v1/mission/missions",{params:t}).then(function(t){return t.data})},status:function(t){return i.a.put("/mission/v1/mission/missions/"+t.id+"/status/"+t.status,{autoShowMessage:!0,showMessageType:"put"})},awardDetails:function(t){return i.a.get("/mission/v1/mission/missions/view-reward/"+t.type).then(function(t){return t.data})},awardAdd:function(t){return i.a.post("/mission/v1/goods/goods",t,{autoShowMessage:!0})},awardEdit:function(t){return i.a.put("/mission/v1/mission/missions/"+t.id,t,{autoShowMessage:!0,showMessageType:"put"})},get_reply:function(t){return i.a.get("/mission/v1/mission/missions/"+t.mission_id+"/reply/"+t.type)},edit_reply:function(t){return i.a.post("/mission/v1/mission/missions/edit-reply/"+t.id,t,{autoShowMessage:!0})},reply_status:function(t){return i.a.put("/mission/v1/mission/missions/reply-status/"+t.id,t,{autoShowMessage:!0,showMessageType:"put"})}}},MXlE:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("mvHQ"),n=a.n(i),s=a("Dd8w"),l=a.n(s),o=a("woOf"),r=a.n(o),c=a("QbVN"),d=a("MN6w"),m=a("M4fF"),p=a.n(m),u=a("5aCZ"),_=a("0xDb"),f={name:"taskAddEdit",data:function(){var t=this;return{active:0,pageLoading:!0,action:this.$route.params.id?"modify":"add",taskFm:{id:this.$route.params.id,app_id:"",rule:"",fans:"",finish_amount:"",start_time:"",end_time:"",pic:[]},dialogVisible:!1,module_cont:{show:!1,id:0,name:"",content:"",text_link:{show:0,data:[]},applets_link:{show:0,data:[]}},small_program:[{id:0,name:"小程序1"},{id:1,name:"小程序2"}],msg_list:[{id:1,type:1,name:"自动回复",msg:"海报生成时系统发送的提示消息，可作为活动的整体描述。",status:2,text_link:{show:0,data:[]},applets_link:{show:0,data:[]}},{id:2,type:2,name:"受邀助力成功提示",msg:"受邀用户提示；当用户受邀关注公众号完成任务后，系统向受邀用户推送的通知消息。",status:2,text_link:{show:0,data:[]},applets_link:{show:0,data:[]}},{id:3,type:3,name:"新用户助力成功提示（任务完成前）",msg:"分享者提示；当有其他人通过分享着的二维码关注公众号后，系统向分享者推送的通知消息。",status:2,text_link:{show:0,data:[]},applets_link:{show:0,data:[]}},{id:4,type:4,name:"新用户助力成功提示（任务完成后）",msg:"分享者提示；当有其他人通过分享着的二维码关注公众号后，系统向分享者推送的通知消息。",status:2,text_link:{show:0,data:[]},applets_link:{show:0,data:[]}},{id:5,type:5,name:"任务提示",msg:"分享者提示；当分享着达到任务完成条件后，系统向分享者推送的通知消息。",status:2,text_link:{show:0,data:[]},applets_link:{show:0,data:[]}},{id:6,type:6,name:"活动结束提示",msg:"活动关闭或结束后，用户扫描海报二维码关注公众号后，系统向用户推送的通知消息。",status:2,text_link:{show:0,data:[]},applets_link:{show:0,data:[]}}],frmRules:{app_id:[{required:!0,message:"请填写公众号App_Id"}],rule:[{required:!0,message:"请填写任务规则"}],fans:[{required:!0,message:"请填写任务达标分数数"}],finish_amount:[{required:!0,message:"请填写任务达标奖励积分额度"}],start_time:[{required:!0,message:"请选择开始时间"}],end_time:[{required:!0,message:"请选择结束时间"}],pic:[{required:!0,message:"请上传海报图片"}]},edit_hint:[{id:0,name:"邀请者昵称",field:"inviter_nickname"},{id:1,name:"受邀者昵称",field:"invited_nickname"},{id:2,name:"任务名称",field:"mission_name"},{id:3,name:"任务量",field:"mission_count"},{id:4,name:"未完成任务量",field:"unfinished_mission_count"},{id:5,name:"已完成任务量",field:"finished_mission_count"},{id:6,name:"任务奖励积分额",field:"mission_reward_points"}],module_cont_rules:[],startPickerOptions:{disabledDate:function(t){var e=new Date;return+t<+new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()+" 00:00")}},sellEndPickerOptions:{disabledDate:function(e){var a=new Date;if(t.taskFm.start_time){var i=new Date(t.taskFm.start_time);+i>+a&&(a=i)}return+e<+new Date(a.getFullYear()+"/"+(a.getMonth()+1)+"/"+a.getDate()+" 00:00")}},toolbar:["link"],menubar:""}},components:{uploadPrizeAvatar:c.a,Tinymce:u.a},watch:{dialogVisible:function(t){t||(this.module_cont.text_link.show=!1,this.module_cont.text_link.data=[],this.module_cont.applets_link.show=!1,this.module_cont.applets_link.data=[])}},created:function(){this.getDetail(),this.getStatus()},methods:{getDetail:function(){var t=this;if("add"===this.action)return this.pageLoading=!1;d.a.awardDetails({type:201}).then(function(e){e.pic=0!==e.pic.length?e.pic:[{id:0,file_path:""}],e.start_time=""===e.start_time||1*e.start_time==0?"":Object(_.c)(e.start_time),e.end_time=""===e.end_time||1*e.end_time==0?"":Object(_.c)(e.end_time),t.taskFm=p.a.assign({},t.taskFm,e),t.pageLoading=!1}).catch(function(e){t.$message({type:"info",message:e.message})})},prev:function(){this.active--<0&&(this.active=0)},next:function(){var t=this;this.$refs.taskFm.validate(function(e){e&&(t.active++>1&&(t.active=0),t.$refs.taskFm.clearValidate())})},next_pic:function(){this.active>=1&&""!==this.taskFm.pic[0].file_path?this.active++>2&&(this.active=0):this.$message({type:"info",message:"请上传海报"})},successUpload:function(t){r()(this.taskFm.pic[0],t)},delHandler:function(){r()(this.taskFm.pic[0],{id:0,file_path:""})},save:function(){var t=this;this.$refs.taskFm.validate(function(e){if(e){var a=r()({},t.taskFm);a.pic=a.pic.map(function(t){return t.id}).join(","),("modify"===t.action?d.a.awardEdit(a):d.a.awardAdd(a)).then(function(){t.$router.back()})}})},checkLink:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"url";(this.module_cont.applets_link.show||this.module_cont.text_link.show)&&this.addLink(0,t),this.module_cont.applets_link.show||(this.module_cont.applets_link.data=[]),this.module_cont.text_link.show||(this.module_cont.text_link.data=[])},addLink:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"url";"mini"===e?this.module_cont.applets_link.data.push({id:t+1,title:"",url:""}):"url"===e&&this.module_cont.text_link.data.push({id:t+1,title:"",url:""})},delLink:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"url",a=this.module_cont;"mini"===e?a.applets_link.data.map(function(e,i){e.id===t.id&&e.title===t.title&&e.url===t.url&&e.app_id===t.app_id&&a.applets_link.data.length>1&&a.applets_link.data.splice(i,1)}):"url"===e&&a.text_link.data.map(function(e,i){e.id===t.id&&e.title===t.title&&e.url===t.url&&a.text_link.data.length>1&&a.text_link.data.splice(i,1)})},module_show:function(t){var e=this,a=t;d.a.get_reply({mission_id:this.taskFm.id,type:t.type}).then(function(t){var i=t.data,n=0,s=0;if(i.ext){if(i.ext.url instanceof Array)i.ext.url.map(function(t){a.text_link.data.push(l()({},t,{id:n+=1,url:decodeURIComponent(t.url)}))});else for(var o in i.ext.url)a.text_link.data.push(l()({},i.ext.url[o],{id:n+=1,url:decodeURIComponent(i.ext.url[o].url)}));if(i.ext.url instanceof Array)i.ext.mini.map(function(t){a.applets_link.data.push(l()({},t,{id:s+=1,url:decodeURIComponent(t.url)}))});else for(var c in i.ext.mini)a.applets_link.data.push(l()({},i.ext.mini[c],{id:s+=1,url:decodeURIComponent(i.ext.mini[c].url)}))}a.text_link.show=a.text_link.data.length>0?1:0,a.applets_link.show=a.applets_link.data.length>0?1:0,r()(e.module_cont,a),r()(e.module_cont,t.data),e.dialogVisible=!0}).catch(function(t){e.$message({type:"info",message:t.message})})},module_determine:function(){var t=this;this.msg_list.map(function(e){e.id===t.module_cont.id&&Object(e,t.module_cont)});var e=this.module_cont,a={url:{},mini:{}};e.text_link.show||(a.url={}),e.text_link.data.map(function(t,e){a.url[e]=l()({},t,{url:encodeURIComponent(t.url)})}),e.applets_link.show||(a.mini={}),e.applets_link.data.map(function(t,e){a.mini[e]=l()({},t,{url:encodeURIComponent(t.url),path:t.path||"pages/index/index"})});var i=n()(a);d.a.edit_reply({id:e.id,content:e.content,ext:i}).then(function(e){t.dialogVisible=!1}).catch(function(e){t.$message({type:"info",message:e.message})})},getStatus:function(){var t=this;this.msg_list.map(function(e){d.a.get_reply({mission_id:t.taskFm.id,type:e.type}).then(function(t){r()(e,t.data)})})},changeStatus:function(t){var e=this;d.a.reply_status({id:t.id,status:1*t.status==1?1:2}).then(function(t){}).catch(function(t){e.$message({type:"info",message:t.message})})}}},h={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container task-list"},[a("el-form",{ref:"taskFm",staticClass:"activity-edit__form",attrs:{model:t.taskFm,rules:t.frmRules,"label-width":"160px"}},[a("div",{staticClass:"step-title"},[a("el-steps",{attrs:{active:t.active,"finish-status":"success"}},[a("el-step",{attrs:{title:"基本设置"}}),t._v(" "),a("el-step",{attrs:{title:"海报设置"}}),t._v(" "),a("el-step",{attrs:{title:"提醒设置"}})],1)],1),t._v(" "),0===t.active?a("div",[a("el-form-item",{attrs:{prop:"app_id",label:"公众号App_Id"}},[a("el-input",{attrs:{placeholder:"公众号App_Id",maxlength:50,name:"app_id",clearable:!0},model:{value:t.taskFm.app_id,callback:function(e){t.$set(t.taskFm,"app_id",e)},expression:"taskFm.app_id"}})],1),t._v(" "),a("el-form-item",{attrs:{prop:"fans",label:"任务达标粉丝数"}},[a("el-input",{attrs:{placeholder:"任务达标粉丝数",name:"fans",clearable:!0},model:{value:t.taskFm.fans,callback:function(e){t.$set(t.taskFm,"fans",e)},expression:"taskFm.fans"}})],1),t._v(" "),a("el-form-item",{attrs:{prop:"finish_amount",label:"任务达标奖励积分额度"}},[a("el-input",{attrs:{placeholder:"任务达标奖励积分额度",name:"finish_amount",clearable:!0},model:{value:t.taskFm.finish_amount,callback:function(e){t.$set(t.taskFm,"finish_amount",e)},expression:"taskFm.finish_amount"}})],1),t._v(" "),a("el-form-item",{attrs:{prop:"start_time",label:"开始时间"}},[a("el-date-picker",{attrs:{editable:!1,type:"datetime","picker-options":t.startPickerOptions,placeholder:"开始时间","value-format":"yyyy-MM-dd HH:mm:ss",align:"right"},model:{value:t.taskFm.start_time,callback:function(e){t.$set(t.taskFm,"start_time",e)},expression:"taskFm.start_time"}})],1),t._v(" "),a("el-form-item",{attrs:{prop:"end_time",label:"结束时间"}},[a("el-date-picker",{attrs:{editable:!1,"default-value":t.taskFm.start_time,type:"datetime","picker-options":t.sellEndPickerOptions,placeholder:"结束时间","value-format":"yyyy-MM-dd HH:mm:ss",align:"right"},model:{value:t.taskFm.end_time,callback:function(e){t.$set(t.taskFm,"end_time",e)},expression:"taskFm.end_time"}})],1),t._v(" "),a("el-form-item",{attrs:{prop:"rule",label:"任务规则"}},[a("tinymce",{attrs:{placeholder:"请输入任务规则",height:300},model:{value:t.taskFm.rule,callback:function(e){t.$set(t.taskFm,"rule",e)},expression:"taskFm.rule"}})],1)],1):t._e(),t._v(" "),1===t.active?a("div",[a("el-form-item",{attrs:{prop:"pic",label:"商品图片"}},[a("div",{staticClass:"commodity-pic"},[a("upload-prize-avatar",{key:t.taskFm.pic[0].id||0,staticClass:"avatar-uploader",attrs:{disabled:!0,showDelImage:!0,"image-id":t.taskFm.pic[0].id||0},on:{"update:imageId":function(e){t.$set(t.taskFm.pic[0],"id || 0",e)},success:t.successUpload,del:function(e){t.delHandler()}},model:{value:t.taskFm.pic[0].file_path,callback:function(e){t.$set(t.taskFm.pic[0],"file_path",e)},expression:"taskFm.pic[0].file_path"}}),t._v(" "),a("small",{staticClass:"text-999"},[t._v("建议尺寸：750*1260，仅支持jpg格式，大小不超过2M")])],1)])],1):t._e(),t._v(" "),2===t.active?a("div",[a("header",{staticClass:"tips-header"},[t._v("（当前仅支持客服消息类型）")]),t._v(" "),a("ul",{staticClass:"msg-set"},t._l(t.msg_list,function(e){return a("li",{key:e.id,staticClass:"msg-list"},[a("div",{staticClass:"title"},[a("span",{staticStyle:{display:"inline-block","margin-right":"15px"}},[t._v(t._s(e.name))]),t._v(" "),a("el-switch",{attrs:{"active-value":1,"inactive-value":2},on:{change:function(a){t.changeStatus(e)}},model:{value:e.status,callback:function(a){t.$set(e,"status",a)},expression:"item.status"}})],1),t._v(" "),a("div",{staticClass:"cont"},[a("div",{staticClass:"msg"},[t._v(t._s(e.msg))]),t._v(" "),a("div",{staticClass:"operatin"},[a("el-button",{on:{click:function(a){t.module_show(e)}}},[t._v("自定义编辑")])],1)])])}))]):t._e(),t._v(" "),a("el-form-item",[t.active>0&&t.active<=2?a("el-button",{on:{click:t.prev}},[t._v("上一步")]):t._e(),t._v(" "),t.active<=0?a("el-button",{staticStyle:{"margin-top":"12px"},on:{click:function(e){e.preventDefault(),e.stopPropagation(),t.$router.back()}}},[t._v("取消")]):t._e(),t._v(" "),t.active<=0?a("el-button",{staticStyle:{"margin-top":"12px"},on:{click:t.next}},[t._v("下一步")]):t._e(),t._v(" "),t.active>=1&&t.active<2?a("el-button",{staticStyle:{"margin-top":"12px"},on:{click:t.next_pic}},[t._v("下一步")]):t._e(),t._v(" "),2===t.active?a("el-button",{attrs:{type:"primary"},on:{click:function(e){e.preventDefault(),e.stopPropagation(),t.save(e)}}},[t._v("保存")]):t._e()],1)],1),t._v(" "),a("el-dialog",{attrs:{title:t.module_cont.name,visible:t.dialogVisible,top:"5vh",width:"70%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("header",[t._v("编辑提示\n      "),a("small",[t._v("涉及到可变的数据字段，请用以下动态字符进行替换")])]),t._v(" "),a("el-row",{staticStyle:{padding:"10px 0 20px"}},[t._l(t.edit_hint,function(e){return[a("el-col",{attrs:{span:12}},[t._v(" "+t._s(e.name)+"： { "+t._s(e.field)+" }")])]})],2),t._v(" "),a("header",[t._v(t._s(t.module_cont.name))]),t._v(" "),a("el-form",{ref:"taskFm",staticClass:"activity-edit__form_tips",attrs:{model:t.module_cont,"label-width":"160px"}},[a("el-form-item",{attrs:{label:"文本信息"}},[a("div",{staticStyle:{width:"680px"}},[a("tinymce",{attrs:{placeholder:"文本信息",height:350,toolbar:t.toolbar,menubar:t.menubar,keywords:t.edit_hint,keywordsShow:!0,miniLinkShow:!0,uploadImgShow:!1},model:{value:t.module_cont.content,callback:function(e){t.$set(t.module_cont,"content",e)},expression:"module_cont.content"}})],1)]),t._v(" "),a("el-row",{staticStyle:{display:"none"}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"添加文字链接"}},[a("el-checkbox",{attrs:{"true-label":1,"false-label":0,name:"show_left_num"},on:{change:function(e){t.checkLink("url")}},model:{value:t.module_cont.text_link.show,callback:function(e){t.$set(t.module_cont.text_link,"show",e)},expression:"module_cont.text_link.show"}}),t._v(" "),a("small",{staticStyle:{"margin-left":"10px"}},[t._v("文字链接加在文本信息末尾")])],1),t._v(" "),t._l(t.module_cont.text_link.data,function(e,i){return[a("el-row",{staticStyle:{"margin-top":"10px"}},[a("el-col",{attrs:{span:20}},[1==t.module_cont.text_link.show?[a("el-form-item",{attrs:{label:"文字"}},[a("el-input",{attrs:{placeholder:"文字",name:"text_link_text",clearable:!0},model:{value:e.title,callback:function(a){t.$set(e,"title",a)},expression:"item.title"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"链接地址"}},[a("el-input",{attrs:{placeholder:"链接地址",name:"text_link_link",clearable:!0},model:{value:e.url,callback:function(a){t.$set(e,"url",a)},expression:"item.url"}})],1)]:t._e()],2),t._v(" "),1==t.module_cont.text_link.show?a("el-col",{staticStyle:{"text-align":"right"},attrs:{span:4}},[i==t.module_cont.text_link.data.length-1?a("el-button",{attrs:{type:"primary",icon:"el-icon-plus",circle:""},on:{click:function(e){t.addLink(t.module_cont.text_link.data.length,"url")}}}):t._e(),t._v(" "),1!=t.module_cont.text_link.data.length?a("el-button",{staticStyle:{"margin-bottom":"20px"},attrs:{type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(a){t.delLink(e,"url")}}}):t._e()],1):t._e()],1)]})],2),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"添加小程序链接"}},[a("el-checkbox",{attrs:{"true-label":1,"false-label":0,name:"show_left_num"},on:{change:function(e){t.checkLink("mini")}},model:{value:t.module_cont.applets_link.show,callback:function(e){t.$set(t.module_cont.applets_link,"show",e)},expression:"module_cont.applets_link.show"}}),t._v(" "),a("small",{staticStyle:{"margin-left":"10px"}},[t._v("小程序链接加在文本信息末尾")])],1),t._v(" "),t._l(t.module_cont.applets_link.data,function(e,i){return[a("el-row",{staticStyle:{"margin-top":"10px"}},[a("el-col",{attrs:{span:20}},[1==t.module_cont.applets_link.show?[a("el-form-item",{attrs:{label:"文字"}},[a("el-input",{attrs:{placeholder:"文字",name:"applets_link_text",clearable:!0},model:{value:e.title,callback:function(a){t.$set(e,"title",a)},expression:"item.title"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"app_id"}},[a("el-input",{attrs:{placeholder:"app_id",name:"app_id",clearable:!0},model:{value:e.app_id,callback:function(a){t.$set(e,"app_id",a)},expression:"item.app_id"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"链接跳转路径"}},[a("el-input",{attrs:{placeholder:"链接跳转路径",name:"applets_link_page",clearable:!0},model:{value:e.path,callback:function(a){t.$set(e,"path",a)},expression:"item.path"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"链接地址"}},[a("el-input",{attrs:{placeholder:"小程序打不开时，跳转链接地址",name:"applets_link_url",clearable:!0},model:{value:e.url,callback:function(a){t.$set(e,"url",a)},expression:"item.url"}})],1)]:t._e()],2),t._v(" "),1==t.module_cont.applets_link.show?a("el-col",{staticStyle:{"text-align":"right"},attrs:{span:4}},[i==t.module_cont.applets_link.data.length-1?a("el-button",{attrs:{type:"primary",icon:"el-icon-plus",circle:""},on:{click:function(e){t.addLink(t.module_cont.text_link.data.length,"mini")}}}):t._e(),t._v(" "),1!=t.module_cont.applets_link.data.length?a("el-button",{staticStyle:{"margin-bottom":"20px"},attrs:{type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(a){t.delLink(e,"mini")}}}):t._e()],1):t._e()],1)]})],2)],1)],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.module_determine}},[t._v("保 存")])],1)],1)],1)},staticRenderFns:[]};var k=a("VU/8")(f,h,!1,function(t){a("IfBx")},"data-v-63a87f9c",null);e.default=k.exports},oNQQ:function(t,e,a){(t.exports=a("FZ+f")(!1)).push([t.i,"\n.step-title[data-v-63a87f9c] {\n  margin-bottom: 40px;\n}\n.tips-header[data-v-63a87f9c] {\n  padding: 20px;\n  border-bottom: 1px solid #e7e7e7;\n  font-size: 14px;\n}\n.upload-container[data-v-63a87f9c] {\n  margin-left: 20px;\n}\n.msg-set .msg-list[data-v-63a87f9c] {\n  list-style: none;\n  padding: 20px 15px;\n  border: 1px solid #e7e7e7;\n  margin-bottom: 20px;\n}\n.msg-set .msg-list .title[data-v-63a87f9c] {\n    font-weight: bold;\n    margin-bottom: 10px;\n    font-size: 14px;\n}\n.msg-set .msg-list .cont[data-v-63a87f9c] {\n    display: -webkit-box;\n    display: -ms-flexbox;\n    display: flex;\n    -webkit-box-pack: justify;\n        -ms-flex-pack: justify;\n            justify-content: space-between;\n    -webkit-box-align: center;\n        -ms-flex-align: center;\n            align-items: center;\n}\n.msg-set .msg-list .cont .msg[data-v-63a87f9c] {\n      max-width: 80%;\n      font-size: 14px;\n}\n.msg-set .msg-list .cont .operatin[data-v-63a87f9c] {\n      margin-right: 15px;\n}\nheader[data-v-63a87f9c] {\n  margin-bottom: 20px;\n  background-color: #f1f1f1;\n  border-radius: 5px;\n  padding: 0.5rem 1rem;\n  font-size: 15px;\n  color: #999;\n}\n.activity-edit__form_tips[data-v-63a87f9c] {\n  max-width: 100% !important;\n}\n.text-link-cont[data-v-63a87f9c] {\n  position: relative;\n}\n.text-link-cont .add-link[data-v-63a87f9c] {\n    position: absolute;\n    right: 10px;\n    top: 50%;\n    -webkit-transform: translateY(-50%);\n            transform: translateY(-50%);\n}\n",""])}});