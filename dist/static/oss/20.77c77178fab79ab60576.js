webpackJsonp([20],{"3eFY":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=a("Dd8w"),n=a.n(l),r=a("Hkkm"),i=a("NYxO"),s={name:"my-template-editor",components:{preview:a("p1Si").a},data:function(){return{pageLoading:!1,templateData:[],words:[],templateFrm:{id:this.$route.params.id||0,event:"",page:""},template_info:null,eventsOptions:[],title:"",preview_list:[],placeholder:null,frmRules:{event:[{required:!0,message:"请选择触发事件"}],page:[{required:!0,message:"请输入小程序页面"}]}}},computed:n()({},Object(i.c)({appid:function(e){return e.templateMsg.appid},mini_program:function(e){return e.templateMsg.mini_program}})),created:function(){this.getData()},methods:{getData:function(){var e=this;this.pageLoading=!0,r.a.details({id:this.templateFrm.id}).then(function(t){for(var a in e.template_info=t,e.words=t.words,e.templateData=t.data.keywords||[],e.templateFrm.event=t.data.event||"",e.templateFrm.page=t.data.page||"",e.title=t.data&&t.data.title?t.data.title:"",t.events)e.eventsOptions.push({label:t.events[a].title,value:a});var l=t.data.example||"";t.words.map(function(t,a){e.preview_list.push({name:t,example:l[a].split("：")[1]})}),t.data.keywords&&t.data.keywords.map(function(t,a){e.preview_list[a].example=t}),e.pageLoading=!1})},changTriggeEvent:function(){var e=this.template_info.events;for(var t in e)t===this.templateFrm.event&&(this.placeholder=e[t].placeholder)},inputChange:function(e){this.preview_list[e].example=this.templateData[e]},save:function(){var e=this;this.$refs.templateFrm.validate(function(t){if(t)if(e.templateData.length===e.words.length){var a=e.templateFrm;a.keywords=e.templateData,r.a.edit(a).then(function(){e.$router.back()})}else e.$message("请完善模板消息内容")})}}},o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.pageLoading,expression:"pageLoading"}],staticClass:"app-container"},[a("el-row",[a("el-col",{attrs:{span:16}},[a("el-form",{ref:"templateFrm",staticClass:"from-style",attrs:{model:e.templateFrm,rules:e.frmRules,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"小程序"}},[e.mini_program?a("small",[e._v(e._s(e.mini_program.nick_name))]):e._e()]),e._v(" "),a("el-form-item",{attrs:{prop:"event",label:"触发事件"}},[a("el-select",{attrs:{placeholder:"请选择触发事件"},on:{change:e.changTriggeEvent},model:{value:e.templateFrm.event,callback:function(t){e.$set(e.templateFrm,"event",t)},expression:"templateFrm.event"}},e._l(e.eventsOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"需转换变量"}},[e.placeholder?a("div",e._l(e.placeholder,function(t,l){return a("span",{staticStyle:{display:"inline-block",margin:"0 5px"}},[e._v("\n              "+e._s(l)+": "+e._s(t)+"\n            ")])})):e._e(),e._v(" "),a("small",{staticStyle:{color:"#999"}},[e._v("可通过选择触发事件，查看对应需转换变量")])]),e._v(" "),a("el-form-item",{attrs:{label:"关键词"}},[e._l(e.words,function(t,l){return[a("el-form-item",{key:l,staticClass:"key-words",attrs:{label:t,"label-width":"80px"}},[a("el-input",{attrs:{placeholder:"请输入"+t,clearable:!0},on:{change:function(t){e.inputChange(l)}},model:{value:e.templateData[l],callback:function(t){e.$set(e.templateData,l,t)},expression:"templateData[index]"}})],1)]})],2),e._v(" "),a("el-form-item",{attrs:{prop:"page",label:"小程序页面"}},[a("el-input",{attrs:{placeholder:"请输入小程序页面",maxlength:50,clearable:!0},model:{value:e.templateFrm.page,callback:function(t){e.$set(e.templateFrm,"page",t)},expression:"templateFrm.page"}})],1),e._v(" "),a("el-form-item",[a("el-button",{on:{click:function(t){t.preventDefault(),t.stopPropagation(),e.$router.back()}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){t.preventDefault(),t.stopPropagation(),e.save(t)}}},[e._v("保存")])],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("preview",{attrs:{preview_list:e.preview_list,title:e.title}})],1)],1)],1)},staticRenderFns:[]};var p=a("VU/8")(s,o,!1,function(e){a("uCR0")},"data-v-661da4a0",null);t.default=p.exports},uCR0:function(e,t,a){var l=a("yKs6");"string"==typeof l&&(l=[[e.i,l,""]]),l.locals&&(e.exports=l.locals);a("rjj0")("58ca31ee",l,!0)},yKs6:function(e,t,a){(e.exports=a("FZ+f")(!1)).push([e.i,"\n.key-words[data-v-661da4a0] {\n  margin-bottom: 10px;\n}\n",""])}});