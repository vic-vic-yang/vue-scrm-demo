webpackJsonp([2],{"4gz5":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("woOf"),o=a.n(i),l=a("tWQL"),m=a("YK4W"),r=a("96JD"),s=a("aU9J"),n=a("0xDb"),c=a("M4fF"),d=a.n(c),p=a("5aCZ"),u=a("QbVN"),_={name:"commodityEditor",components:{customElTable:m.a,uploadCommodityPic:r.a,imgCropper:s.a,uploadPrizeAvatar:u.a,Tinymce:p.a},data:function(){var t=this;return{pageLoading:!0,action:this.$route.params.id?"modify":"add",commodityFrm:{id:this.$route.params.id||0,type:"",name:"",pic:[],sell_description:"",price:"",show_left_num:0,sell_status:1,sell_start_time:"",sell_end_time:"",validate_time_type:1,validate_date:0,validate_start_time:"",validate_end_time:"",is_holiday_use:1,use_description:"",avatarUrl2:null,desc:"",is_can_buy:1,share_pic:[]},frmRules:{type:[{required:!0,message:"请选择商品类型"}],name:[{required:!0,message:"请填写商品名称"}],sell_description:[{required:!0,message:"请填写商品卖点"}],price:[{required:!0,message:"请填写商品价格"}],sell_start_time:[{required:!0,message:"请选择上架开始时间"}],sell_end_time:[{required:!0,message:"请选择上架结束时间"}],validate_start_time:[{required:!0,message:"请选择生效开始时间"}],validate_end_time:[{required:!0,message:"请选择生效结束时间"}]},startPickerOptions:{disabledDate:function(t){var e=new Date;return+t<+new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()+" 00:00")}},sellEndPickerOptions:{disabledDate:function(e){var a=new Date;if(t.commodityFrm.sell_start_time){var i=new Date(t.commodityFrm.sell_start_time);+i>+a&&(a=i)}return+e<+new Date(a.getFullYear()+"/"+(a.getMonth()+1)+"/"+a.getDate()+" 00:00")}},validateEndPickerOptions:{disabledDate:function(e){var a=new Date;if(t.commodityFrm.validate_start_time){var i=new Date(t.commodityFrm.validate_start_time);+i>+a&&(a=i)}return+e<+new Date(a.getFullYear()+"/"+(a.getMonth()+1)+"/"+a.getDate()+" 00:00")}},commodityTypeOptions:[{value:1,label:"实物商品"},{value:2,label:"电子卡券"}]}},created:function(){this.getDetail()},methods:{getDetail:function(){var t=this;if("add"===this.action)return this.pageLoading=!1;l.a.get(this.commodityFrm.id).then(function(e){var a=e.sell_start_time,i=e.sell_end_time,o=e.validate_start_time,l=e.validate_end_time;e.sell_start_time=1*a?Object(n.c)(1e3*a):"",e.sell_end_time=1*i?Object(n.c)(1e3*i):"",e.validate_start_time=1*o?Object(n.c)(1e3*o):"",e.validate_end_time=1*l?Object(n.c)(1e3*l):"",e.pic=e.pic||[],e.share_pic=e.share_pic[0]||{},e.total_num=1*e.total_num-1*e.sell_num,t.commodityFrm=d.a.assign({},t.commodityFrm,e),t.pageLoading=!1}).catch(function(){t.pageLoading=!1})},save:function(){var t=this;this.$refs.commodityFrm.validate(function(e){if(e){var a=1*t.commodityFrm.sell_num||0,i=o()({},t.commodityFrm);i.pic=i.pic.map(function(t){return t.id}).join(","),i.share_pic=i.share_pic.id+"",i.total_num=1*t.commodityFrm.total_num+a,("modify"===t.action?l.a.edit(i):l.a.add(i)).then(function(){t.$router.back()})}})},get_pic:function(t){this.commodityFrm.pic=t},successShare:function(t){this.commodityFrm.share_pic={id:t.id,file_path:t.url}},deleteImg:function(){this.commodityFrm.share_pic={}}}},y={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.pageLoading,expression:"pageLoading"}],staticClass:"app-container"},[a("el-form",{ref:"commodityFrm",staticClass:"commodity-edit__form",attrs:{model:t.commodityFrm,rules:t.frmRules,"label-width":"120px"}},[a("el-form-item",{attrs:{prop:"type",label:"商品类型"}},[a("el-select",{attrs:{placeholder:"请选择商品类型"},model:{value:t.commodityFrm.type,callback:function(e){t.$set(t.commodityFrm,"type",e)},expression:"commodityFrm.type"}},t._l(t.commodityTypeOptions,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),a("el-form-item",{attrs:{prop:"name",label:"商品名"}},[a("el-input",{attrs:{placeholder:"请输入商品名",maxlength:40,name:"name",clearable:!0},model:{value:t.commodityFrm.name,callback:function(e){t.$set(t.commodityFrm,"name",e)},expression:"commodityFrm.name"}})],1),t._v(" "),a("el-form-item",{attrs:{prop:"pic",label:"商品图片"}},[a("img-cropper",{attrs:{pic:t.commodityFrm.pic},on:{get_pic:t.get_pic}}),t._v(" "),a("small",{staticClass:"text-999"},[t._v("建议尺寸：800*760像素，你可以拖拽图片调整顺序，最多上传15张")])],1),t._v(" "),a("el-form-item",{attrs:{prop:"sell_description",label:"商品卖点"}},[a("el-input",{attrs:{placeholder:"请输入商品卖点",name:"sell_description",clearable:!0},model:{value:t.commodityFrm.sell_description,callback:function(e){t.$set(t.commodityFrm,"sell_description",e)},expression:"commodityFrm.sell_description"}}),t._v(" "),a("small",{staticClass:"text-999"},[t._v("在商品详情页标题下面展示卖点信息，建议60字以内")])],1),t._v(" "),a("el-form-item",{attrs:{prop:"price",label:"价格"}},[a("el-input-number",{attrs:{min:0,name:"person_num"},model:{value:t.commodityFrm.price,callback:function(e){t.$set(t.commodityFrm,"price",e)},expression:"commodityFrm.price"}}),t._v(" "),a("span",{staticClass:"ml-5 text-666"},[t._v("元")])],1),t._v(" "),a("el-form-item",{attrs:{prop:"total_num",label:"库存"}},[a("el-input-number",{attrs:{min:0,name:"total_num"},model:{value:t.commodityFrm.total_num,callback:function(e){t.$set(t.commodityFrm,"total_num",e)},expression:"commodityFrm.total_num"}}),t._v(" "),a("span",{staticClass:"ml-5 text-666"},[t._v("件")]),t._v(" "),"modify"==t.action?a("small",{staticClass:"text-999",staticStyle:{"margin-left":"40px"}},[t._v("已兑换 "+t._s(t.commodityFrm.sell_num)+" 件")]):t._e()],1),t._v(" "),a("el-form-item",{attrs:{prop:"show_left_num",label:"是否显示商品详情剩余件数","label-width":"auto"}},[a("el-checkbox",{attrs:{"true-label":1,"false-label":0,name:"show_left_num"},model:{value:t.commodityFrm.show_left_num,callback:function(e){t.$set(t.commodityFrm,"show_left_num",e)},expression:"commodityFrm.show_left_num"}})],1),t._v(" "),a("el-form-item",{attrs:{prop:"sell_status",label:"上架时间"}},[a("el-radio-group",{model:{value:t.commodityFrm.sell_status,callback:function(e){t.$set(t.commodityFrm,"sell_status",e)},expression:"commodityFrm.sell_status"}},[a("el-radio",{attrs:{label:0}},[t._v("暂不售卖，放入仓库")]),t._v(" "),a("el-radio",{attrs:{label:1}},[t._v("立即上架售卖")]),t._v(" "),a("el-radio",{attrs:{label:2}},[t._v("自定义上架时间")])],1)],1),t._v(" "),2===t.commodityFrm.sell_status?[a("el-form-item",{attrs:{prop:"sell_start_time",label:"上架开始时间"}},[a("el-date-picker",{attrs:{editable:!1,type:"datetime","picker-options":t.startPickerOptions,placeholder:"开始时间","value-format":"yyyy-MM-dd HH:mm:ss",align:"right"},model:{value:t.commodityFrm.sell_start_time,callback:function(e){t.$set(t.commodityFrm,"sell_start_time",e)},expression:"commodityFrm.sell_start_time"}})],1),t._v(" "),a("el-form-item",{attrs:{prop:"sell_end_time",label:"上架结束时间"}},[a("el-date-picker",{attrs:{editable:!1,"default-value":t.commodityFrm.sell_start_time,type:"datetime","picker-options":t.sellEndPickerOptions,placeholder:"结束时间","value-format":"yyyy-MM-dd HH:mm:ss",align:"right"},model:{value:t.commodityFrm.sell_end_time,callback:function(e){t.$set(t.commodityFrm,"sell_end_time",e)},expression:"commodityFrm.sell_end_time"}})],1)]:t._e(),t._v(" "),a("el-form-item",{attrs:{prop:"validate_time_type",label:"有效期"}},[a("el-radio-group",{model:{value:t.commodityFrm.validate_time_type,callback:function(e){t.$set(t.commodityFrm,"validate_time_type",e)},expression:"commodityFrm.validate_time_type"}},[a("el-radio",{attrs:{label:1}},[t._v("生效时间起长期可用")]),t._v(" "),a("el-radio",{attrs:{label:2}},[t._v("\n          生效时间起\n          "),a("el-input",{staticClass:"limit-count__input",attrs:{type:"num",name:"validate_date",min:0,size:"mini",disabled:2!==t.commodityFrm.validate_time_type},model:{value:t.commodityFrm.validate_date,callback:function(e){t.$set(t.commodityFrm,"validate_date",e)},expression:"commodityFrm.validate_date"}}),t._v("\n          天内可用\n        ")],1),t._v(" "),a("el-radio",{attrs:{label:3}},[t._v("自定义生效时间")])],1)],1),t._v(" "),3===t.commodityFrm.validate_time_type?[a("el-form-item",{attrs:{prop:"validate_start_time",label:"生效开始时间"}},[a("el-date-picker",{attrs:{editable:!1,type:"datetime","picker-options":t.startPickerOptions,placeholder:"开始时间","value-format":"yyyy-MM-dd HH:mm:ss",align:"right"},model:{value:t.commodityFrm.validate_start_time,callback:function(e){t.$set(t.commodityFrm,"validate_start_time",e)},expression:"commodityFrm.validate_start_time"}})],1),t._v(" "),a("el-form-item",{attrs:{prop:"validate_end_time",label:"生效结束时间"}},[a("el-date-picker",{attrs:{editable:!1,"default-value":t.commodityFrm.validate_start_time,type:"datetime","picker-options":t.validateEndPickerOptions,placeholder:"结束时间","value-format":"yyyy-MM-dd HH:mm:ss",align:"right"},model:{value:t.commodityFrm.validate_end_time,callback:function(e){t.$set(t.commodityFrm,"validate_end_time",e)},expression:"commodityFrm.validate_end_time"}})],1)]:t._e(),t._v(" "),a("el-form-item",{attrs:{prop:"is_holiday_use",label:"节假日是否可用"}},[a("el-checkbox",{attrs:{"true-label":0,"false-label":1,name:"show_left_num"},model:{value:t.commodityFrm.is_holiday_use,callback:function(e){t.$set(t.commodityFrm,"is_holiday_use",e)},expression:"commodityFrm.is_holiday_use"}})],1),t._v(" "),a("el-form-item",{attrs:{prop:"is_can_buy",label:"商品是否可购买"}},[a("el-checkbox",{attrs:{"true-label":1,"false-label":2,name:"is_can_buy"},model:{value:t.commodityFrm.is_can_buy,callback:function(e){t.$set(t.commodityFrm,"is_can_buy",e)},expression:"commodityFrm.is_can_buy"}})],1),t._v(" "),a("el-form-item",{attrs:{prop:"share_pic",label:"分享海报（默认是商品的第一张图片）"}},[a("upload-prize-avatar",{on:{success:t.successShare},model:{value:t.commodityFrm.share_pic.file_path,callback:function(e){t.$set(t.commodityFrm.share_pic,"file_path",e)},expression:"commodityFrm.share_pic.file_path"}}),t._v(" "),t.commodityFrm.share_pic.file_path?a("el-button",{attrs:{type:"danger"},on:{click:t.deleteImg}},[t._v("删除图片")]):t._e()],1),t._v(" "),a("el-form-item",{attrs:{prop:"use_description",label:"使用说明"}},[a("tinymce",{attrs:{placeholder:"请输入商品详情",height:260},model:{value:t.commodityFrm.use_description,callback:function(e){t.$set(t.commodityFrm,"use_description",e)},expression:"commodityFrm.use_description"}})],1),t._v(" "),a("el-form-item",{attrs:{prop:"desc",label:"商品详情"}},[a("tinymce",{attrs:{placeholder:"请输入商品详情",height:300},model:{value:t.commodityFrm.desc,callback:function(e){t.$set(t.commodityFrm,"desc",e)},expression:"commodityFrm.desc"}})],1),t._v(" "),a("el-form-item",[a("el-button",{on:{click:function(e){e.preventDefault(),e.stopPropagation(),t.$router.back()}}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){e.preventDefault(),e.stopPropagation(),t.save(e)}}},[t._v("保存")])],1)],2)],1)},staticRenderFns:[]};var f=a("VU/8")(_,y,!1,function(t){a("j4hE")},null,null);e.default=f.exports},"96JD":function(t,e,a){"use strict";var i=a("M4fF"),o=a.n(i),l=a("DAYN"),m=a.n(l),r=a("QbVN"),s={name:"uploadCommodityPic",model:{prop:"pic",event:"change"},props:{pic:{type:Array,default:function(){return[]}}},components:{draggable:m.a,uploadPrizeAvatar:r.a},data:function(){return{picLists:this.pic||[]}},watch:{picLists:{immediate:!0,deep:!0,handler:function(t){t&&(this.findUploadPosition(t)<0&&t.length<15&&this.picLists.push({id:"",file_path:""}),this.$emit("change",this.getPicData(t)))}}},methods:{findUploadPosition:function(t){return o.a.findIndex(t,function(t){return!t.id&&!t.file_path})},getPicData:function(t){return t=o.a.cloneDeep(t),o.a.filter(t,function(t){return t.id&&t.file_path})},delHandler:function(t){this.picLists.splice(t,1)}}},n={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("draggable",{staticClass:"dragArea",attrs:{list:t.picLists,options:{group:"article"}}},t._l(t.picLists,function(e,i){return a("upload-prize-avatar",{key:i+"_"+e.id,staticClass:"commodity-pic",attrs:{disabled:!0,showDelImage:!0,"image-id":e.id},on:{"update:imageId":function(a){t.$set(e,"id",a)},del:function(e){t.delHandler(i)}},model:{value:e.file_path,callback:function(a){t.$set(e,"file_path",a)},expression:"pic.file_path"}})}))],1)},staticRenderFns:[]};var c=a("VU/8")(s,n,!1,function(t){a("9I6B"),a("xOlk")},"data-v-a7148aa0",null);e.a=c.exports},"9I6B":function(t,e,a){var i=a("aQlL");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);a("rjj0")("ff8f00c8",i,!0)},"B0+A":function(t,e,a){(t.exports=a("FZ+f")(!1)).push([t.i,"\n.commodity-pic .single-image__uploader .el-upload{\n  width: 126px;\n  height: 126px;\n}\n",""])},aQlL:function(t,e,a){(t.exports=a("FZ+f")(!1)).push([t.i,"\n.commodity-pic[data-v-a7148aa0]{\n  display: inline-block;\n  margin: 6px 4px;\n  width: auto;\n}\n",""])},cyON:function(t,e,a){(t.exports=a("FZ+f")(!1)).push([t.i,"\n.limit-count__input {\n  width: 66px;\n}\n.limit-count__input > input {\n  padding: 0 10px;\n  text-align: center;\n}\n",""])},j4hE:function(t,e,a){var i=a("cyON");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);a("rjj0")("78bff7bd",i,!0)},tWQL:function(t,e,a){"use strict";var i=a("gyMJ");e.a={list:function(t){return i.a.get("/groupBuy/v1/goods/goods/get-list",{params:t}).then(function(t){return t.data})},del:function(t){return i.a.delete("/groupBuy/v1/goods/goods/del",{data:{id:t.id},autoShowMessage:!0})},status:function(t){return i.a.post("/groupBuy/v1/goods/goods/sell-status",{id:t.id,status:1*!(1*t.sell_status)},{autoShowMessage:!0,showMessageType:"put"})},get:function(t){return i.a.get("/groupBuy/v1/goods/goods/get-one?id="+t).then(function(t){return t.data})},add:function(t){return i.a.post("/groupBuy/v1/goods/goods/add",t,{autoShowMessage:!0})},edit:function(t){return i.a.post("/groupBuy/v1/goods/goods/edit",t,{autoShowMessage:!0})}}},xOlk:function(t,e,a){var i=a("B0+A");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);a("rjj0")("063db862",i,!0)}});