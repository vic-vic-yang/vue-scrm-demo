webpackJsonp([9],{Dq3O:function(e,t,i){var a=i("kVuJ");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);i("rjj0")("25422e40",a,!0)},k80t:function(e,t,i){"use strict";var a=i("gyMJ");t.a={list:function(e){return a.a.get("/integral/v1/lottery/rule-prizes",{params:e}).then(function(e){return e.data})},get:function(e){return a.a.get("/integral/v1/lottery/rule-prizes/"+e.id)},add:function(e){return a.a.post("/integral/v1/lottery/rule-prizes",e,{autoShowMessage:!0})},edit:function(e){return a.a.put("/integral/v1/lottery/rule-prizes/"+e.id,e,{autoShowMessage:!0,showMessageType:"put"})},del:function(e){return a.a.delete("/integral/v1/lottery/rule-prizes/"+e.id,{autoShowMessage:!0})},getLevel:function(){return a.a.get("/integral/v1/lottery/rule-prize/get-level")},getWinPercent:function(e){return a.a.get("/integral/v1/lottery/rule-prizes/"+e.id+"/rule/"+e.rule_id+"/win-percent/"+e.num)},getUnallocatedNum:function(e){return a.a.get("/integral/v1/lottery/rule-prizes/"+e.id+"/unallocated-num/"+e.rule_id)}}},kVuJ:function(e,t,i){(e.exports=i("FZ+f")(!1)).push([e.i,"\n.p-left[data-v-f545a90a]{\r\n  padding-left: 5px;\n}\n.article_pages[data-v-f545a90a]{\r\n  text-align: right;\r\n  margin: 5px 0 0;\n}\r\n",""])},"zWu+":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("woOf"),r=i.n(a),n=i("k80t"),l=i("IIVU"),o=i("M4fF"),u=i.n(o),s={name:"rule_create",data:function(){return{pageLoading:!0,action:this.$route.params.id?"modify":"add",rule_id:this.$route.query.rule_id,prizeFrm:{id:this.$route.params.id||0,prize_level_id:"",prize_id:"",total_num:1,prize_limit_num:1,sort:"",unallocated_num:0,win_percent:0,use_num:1},frmRules:{prize_level_id:[{required:!0,message:"请选择奖品等级"}],prize:[{required:!0,message:"请选择奖品"}],total_num:[{required:!0,message:"请输入奖品分配数"}]},levelOptions:[],PrizeOptions:[],pageIndex:1,pageSize:10,totalCount:0,total_num:"",unallocated_num:"",total_num_dis:!1}},computed:{total_num_max:function(){return 1*this.prizeFrm.unallocated_num+1*this.prizeFrm.total_num||0}},created:function(){this.getLevel(),this.getPrizeOptions(),this.getDetail()},methods:{getDetail:function(){var e=this;if("add"===this.action)return this.total_num=1,this.total_num_dis=!1,this.pageLoading=!1;n.a.get({id:this.prizeFrm.id}).then(function(t){e.prizeFrm=u.a.assign({},e.prizeFrm,t.data),e.prizeFrm.prize_level_id=1*e.prizeFrm.prize_level_id,e.total_num=t.data.total_num,e.unallocated_num=t.data.unallocated_num,e.total_num_dis=!0,e.pageLoading=!1}).catch(function(){e.pageLoading=!1})},getLevel:function(){var e=this;n.a.getLevel().then(function(t){e.levelOptions=u.a.assign({},e.levelOptions,t.data),e.pageLoading=!1}).catch(function(){e.pageLoading=!1})},getPrizeOptions:function(){var e=this;l.a.list({page_index:this.pageIndex,page_size:this.pageSize}).then(function(t){e.PrizeOptions=(t.result||[]).map(function(e){return{id:e.id,name:e.name}}),e.totalCount=1*t.totalCount})},changePrize:function(e){var t=this;this.total_num_dis=!0,this.prizeFrm.total_num=1,this.total_num=1,n.a.getUnallocatedNum({id:e,rule_id:this.rule_id}).then(function(e){t.prizeFrm.unallocated_num=e.data-1,t.unallocated_num=e.data-1})},changeTotalNum:function(e){var t=this;n.a.getWinPercent({id:this.prizeFrm.id,rule_id:this.rule_id,num:e}).then(function(e){t.prizeFrm.win_percent=e.data,t.prizeFrm.unallocated_num=t.unallocated_num-(t.prizeFrm.total_num-t.total_num)})},currentChangePrize:function(e){this.pageIndex=e,this.getPrizeOptions()},save:function(){var e=this;this.$refs.prizeFrm.validate(function(t){if(t){var i=r()({},e.prizeFrm);"add"===e.action&&(i.rule_id=e.rule_id),("modify"===e.action?n.a.edit(i):n.a.add(i)).then(function(){e.$router.back()})}})}}},p={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.pageLoading,expression:"pageLoading"}],staticClass:"app-container"},[i("el-form",{ref:"prizeFrm",staticClass:"activity-edit__form",attrs:{model:e.prizeFrm,rules:e.frmRules,"label-width":"140px"}},[i("el-form-item",{attrs:{prop:"prize_level_id",label:"奖品等级"}},[i("el-select",{attrs:{clearable:"",placeholder:"请选择奖品等级"},model:{value:e.prizeFrm.prize_level_id,callback:function(t){e.$set(e.prizeFrm,"prize_level_id",t)},expression:"prizeFrm.prize_level_id"}},e._l(e.levelOptions,function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),i("el-form-item",{attrs:{prop:"prize_id",label:"奖品选择"}},[i("el-select",{attrs:{disabled:"modify"==e.action,clearable:"",placeholder:"请选择奖品"},on:{change:e.changePrize},model:{value:e.prizeFrm.prize_id,callback:function(t){e.$set(e.prizeFrm,"prize_id",t)},expression:"prizeFrm.prize_id"}},[e._l(e.PrizeOptions,function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),e._v(" "),i("div",{staticClass:"article_pages"},[i("el-pagination",{attrs:{"page-size":e.pageSize,"pager-count":Math.ceil(e.totalCount/e.pageSize),"current-page":e.pageIndex,layout:"prev, pager, next",total:e.totalCount},on:{"current-change":e.currentChangePrize}})],1)],2)],1),e._v(" "),i("el-form-item",{attrs:{label:"奖品未分配数"}},[i("span",{staticClass:"p-left"},[e._v(e._s(e.prizeFrm.unallocated_num))])]),e._v(" "),i("el-form-item",{attrs:{prop:"total_num",label:"奖品分配数"}},[i("el-input-number",{attrs:{min:1*e.prizeFrm.use_num||0,max:e.total_num_max,placeholder:"请输入奖品分配数",name:"total_num",disabled:!e.total_num_dis},on:{change:e.changeTotalNum},model:{value:e.prizeFrm.total_num,callback:function(t){e.$set(e.prizeFrm,"total_num",t)},expression:"prizeFrm.total_num"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"测算中奖率(%)"}},[i("span",{staticClass:"p-left"},[e._v(e._s(e.prizeFrm.win_percent)+"%")])]),e._v(" "),i("el-form-item",{attrs:{prop:"prize_limit_num",label:"单人中奖限制"}},[i("el-input-number",{attrs:{min:0,placeholder:"请输入单人中奖限制",name:"prize_limit_num"},model:{value:e.prizeFrm.prize_limit_num,callback:function(t){e.$set(e.prizeFrm,"prize_limit_num",t)},expression:"prizeFrm.prize_limit_num"}})],1),e._v(" "),i("el-form-item",{attrs:{prop:"sort",label:"排序"}},[i("el-input",{attrs:{placeholder:"请输入排序",name:"sort"},model:{value:e.prizeFrm.sort,callback:function(t){e.$set(e.prizeFrm,"sort",t)},expression:"prizeFrm.sort"}})],1),e._v(" "),i("el-form-item",[i("el-button",{on:{click:function(t){t.preventDefault(),t.stopPropagation(),e.$router.back()}}},[e._v("取消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(t){t.preventDefault(),t.stopPropagation(),e.save(t)}}},[e._v("保存")])],1)],1)],1)},staticRenderFns:[]};var m=i("VU/8")(s,p,!1,function(e){i("Dq3O")},"data-v-f545a90a",null);t.default=m.exports}});