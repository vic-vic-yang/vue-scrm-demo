webpackJsonp([8],{ARrl:function(e,t,a){"use strict";var n=a("gyMJ");t.a={list:function(e){return n.a.get("/base/v1/third/template-settings",{params:e}).then(function(e){return e.data})},template_list:function(e){return n.a.get("/base/v1/third/template-settings/list?appid="+e.appid).then(function(e){return e.data})},add:function(e){return n.a.post("/base/v1/third/template-settings",e).then(function(e){return e.data})},status:function(e){return n.a.put("/base/v1/third/template-settings/"+e.id+"/status",e,{autoShowMessage:!0})},del:function(e){return n.a.delete("/base/v1/third/template-settings/"+e.id,e,{autoShowMessage:!0}).then(function(e){return e.data})},details:function(e){return n.a.get("/base/v1/third/template-settings/"+e.id).then(function(e){return e.data})},edit:function(e){return n.a.put("/base/v1/third/template-settings/"+e.id,e,{autoShowMessage:!0,showMessageType:"put"})},trigger:function(){return n.a.get("/base/v1/third/template-settings/event").then(function(e){return e.data})},send_user:function(){return n.a.get("/base/v1/third/template-settings/send-user").then(function(e){return e.data})}}},EW3m:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("woOf"),i=a.n(n),r=a("Dd8w"),l=a.n(r),s=a("ARrl"),p=a("NYxO"),o={name:"message-push-editor",components:{preview:a("p1Si").a},data:function(){return{pageLoading:!1,templateData:[],action:this.$route.params.id?"modify":"add",words:[],templateFrm:{appid:this.$store.state.templateMsg.appid,id:this.$route.params.id||0,event:"",page:"",send_type:1,template_id:"",send_users:"",frequency:"",time:"",keywords:"",title:""},eventsOptions:[],events:null,title:"",preview_list:[],placeholder:null,pageOptions:this.$store.state.templateMsg.pageOptions,typeOptions:this.$store.state.templateMsg.typeOptions,sendUsersOptions:[],frequencyOptions:[{id:1,name:"每天一次"},{id:2,name:"仅此一次"}],templateOptions:[],frmRules:{}}},computed:l()({},Object(p.c)({appid:function(e){return e.templateMsg.appid},mini_program:function(e){return e.templateMsg.mini_program}})),created:function(){var e=this;this.pageLoading=!0,this.getTemplate().then(function(t){e.getData()})},methods:{getData:function(){var e=this;if("add"===this.action)return this.changTriggeEType(),void(this.pageLoading=!1);s.a.details({id:this.templateFrm.id}).then(function(t){t.send_type=1*t.send_type,1===t.send_type&&(t.frequency=1*t.frequency,t.time=t.hours+":"+t.minutes),e.templateFrm=i()(e.templateFrm,t),e.templateData=t.keywords||[],e.title=t.data&&t.data.title?t.data.title:"";var a=e.templateOptions.find(function(t){return t.template_id===e.templateFrm.template_id});a?(a.example.map(function(t){e.preview_list.push({name:t.split("：")[0],example:t.split("：")[1]}),e.words.push(t.split("：")[0])}),t.keywords&&t.keywords.map(function(t,a){e.preview_list[a].example=t})):e.$message("该推送消息的模板消息已禁用或已不存在!"),e.changTriggeEType(),e.pageLoading=!1})},getTemplate:function(){var e=this;return s.a.template_list({appid:this.appid}).then(function(t){return e.templateOptions=t||[],t})},getTrigger:function(){var e=this;s.a.trigger().then(function(t){for(var a in e.events=t,t)e.eventsOptions.push({label:t[a].title,value:a});e.changTriggeEvent(),e.pageLoading=!1})},getSendUser:function(){var e=this;s.a.send_user().then(function(t){e.sendUsersOptions=t,e.pageLoading=!1})},changTriggeEType:function(){2===this.templateFrm.send_type?this.getTrigger():this.getSendUser()},templateChange:function(e){var t=this,a=this.templateOptions.find(function(e){return e.template_id===t.templateFrm.template_id});return"change"===e&&(this.templateFrm.title=a.title,this.templateData=[]),this.setWord(a)},setWord:function(e){var t=this;return this.words=[],this.preview_list=[],e.example.map(function(e){t.preview_list.push({name:e.split("：")[0],example:e.split("：")[1]}),t.words.push(e.split("：")[0])}),!0},changTriggeEvent:function(){var e=this.events;for(var t in e)t===this.templateFrm.event&&(this.placeholder=e[t].placeholder)},inputChange:function(e){this.preview_list[e].example=this.templateData[e]},save:function(){var e=this;this.$refs.templateFrm.validate(function(t){if(t)if(e.templateData.length===e.words.length){var a=e.templateFrm;if(a.keywords=e.templateData,1===a.send_type){var n=a.time.split(":");a.hours=n[0],a.minutes=n[1]}("modify"===e.action?s.a.edit(a):s.a.add(a)).then(function(){e.$router.back()})}else e.$message("请完善模板消息内容")})}}},m={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.pageLoading,expression:"pageLoading"}],staticClass:"app-container"},[a("el-row",[a("el-col",{attrs:{span:16}},[a("el-form",{ref:"templateFrm",staticClass:"from-style",attrs:{model:e.templateFrm,rules:e.frmRules,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"小程序"}},[e.mini_program?a("small",[e._v(e._s(e.mini_program.nick_name))]):e._e()]),e._v(" "),a("el-form-item",{attrs:{prop:"send_type",label:"消息类型"}},[a("el-select",{attrs:{disabled:"modify"==e.action,placeholder:"请选择消息类型"},on:{change:e.changTriggeEType},model:{value:e.templateFrm.send_type,callback:function(t){e.$set(e.templateFrm,"send_type",t)},expression:"templateFrm.send_type"}},e._l(e.typeOptions,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),1==e.templateFrm.send_type?[a("el-form-item",{attrs:{prop:"send_users",label:"推送对象"}},[a("el-select",{attrs:{placeholder:"请选择推送对象"},model:{value:e.templateFrm.send_users,callback:function(t){e.$set(e.templateFrm,"send_users",t)},expression:"templateFrm.send_users"}},e._l(e.sendUsersOptions,function(e,t){return a("el-option",{key:t,attrs:{label:e,value:t}})}))],1),e._v(" "),a("el-form-item",{attrs:{prop:"frequency",label:"推送频率"}},[a("el-select",{attrs:{placeholder:"请选择推送频率"},model:{value:e.templateFrm.frequency,callback:function(t){e.$set(e.templateFrm,"frequency",t)},expression:"templateFrm.frequency"}},e._l(e.frequencyOptions,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),a("el-form-item",{attrs:{prop:"time",label:"推送时间"}},[a("el-time-picker",{attrs:{format:"HH:mm","value-format":"HH:mm",placeholder:"选择推送时间"},model:{value:e.templateFrm.time,callback:function(t){e.$set(e.templateFrm,"time",t)},expression:"templateFrm.time"}})],1)]:e._e(),e._v(" "),2==e.templateFrm.send_type?[a("el-form-item",{attrs:{prop:"event",label:"触发事件"}},[a("el-select",{attrs:{placeholder:"请选择触发事件"},on:{change:e.changTriggeEvent},model:{value:e.templateFrm.event,callback:function(t){e.$set(e.templateFrm,"event",t)},expression:"templateFrm.event"}},e._l(e.eventsOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"需转换变量"}},[e.placeholder?a("div",e._l(e.placeholder,function(t,n){return a("span",{staticStyle:{display:"inline-block",margin:"0 5px"}},[e._v("\n                "+e._s(n)+": "+e._s(t)+"\n              ")])})):e._e(),e._v(" "),a("small",{staticStyle:{color:"#999"}},[e._v("可通过选择触发事件，查看对应需转换变量")])])]:e._e(),e._v(" "),a("el-form-item",{attrs:{prop:"template_id",label:"选择模板"}},[a("el-select",{attrs:{placeholder:"请选择模板"},on:{change:function(t){e.templateChange("change")}},model:{value:e.templateFrm.template_id,callback:function(t){e.$set(e.templateFrm,"template_id",t)},expression:"templateFrm.template_id"}},e._l(e.templateOptions,function(e){return a("el-option",{key:e.template_id,attrs:{label:e.title,value:e.template_id}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"关键词"}},[e._l(e.words,function(t,n){return[a("el-form-item",{key:n,staticClass:"key-words",attrs:{label:t,"label-width":"80px"}},[a("el-input",{attrs:{placeholder:"请输入"+t,clearable:!0},on:{change:function(t){e.inputChange(n)}},model:{value:e.templateData[n],callback:function(t){e.$set(e.templateData,n,t)},expression:"templateData[index]"}})],1)]}),e._v(" "),a("small",{staticStyle:{color:"#999"}},[e._v("选择模板后，才会有对应的关键词")])],2),e._v(" "),a("el-form-item",{attrs:{prop:"page",label:"进入小程序页面"}},[a("el-select",{attrs:{placeholder:"请选择进入小程序页面"},model:{value:e.templateFrm.page,callback:function(t){e.$set(e.templateFrm,"page",t)},expression:"templateFrm.page"}},e._l(e.pageOptions,function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.page}})}))],1),e._v(" "),a("el-form-item",[a("el-button",{on:{click:function(t){t.preventDefault(),t.stopPropagation(),e.$router.back()}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){t.preventDefault(),t.stopPropagation(),e.save(t)}}},[e._v("保存")])],1)],2)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("preview",{attrs:{preview_list:e.preview_list,title:e.title}})],1)],1)],1)},staticRenderFns:[]};var u=a("VU/8")(o,m,!1,function(e){a("Yr8S")},"data-v-4c758a00",null);t.default=u.exports},ITvu:function(e,t,a){(e.exports=a("FZ+f")(!1)).push([e.i,"\n.key-words[data-v-4c758a00] {\n  margin-bottom: 10px;\n}\n",""])},Yr8S:function(e,t,a){var n=a("ITvu");"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);a("rjj0")("d0ee3030",n,!0)}});