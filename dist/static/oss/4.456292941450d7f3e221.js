webpackJsonp([4],{"89hN":function(t,e,a){var i=a("JYf8");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);a("rjj0")("64dc5c02",i,!0)},EfIZ:function(t,e,a){(t.exports=a("FZ+f")(!1)).push([t.i,"\n.limit-count__input {\n  width: 66px;\n}\n.limit-count__input > input {\n  padding: 0 10px;\n  text-align: center;\n}\n.activity-edit__form header {\n  margin-bottom: 20px;\n  background-color: #f1f1f1;\n  border-radius: 5px;\n  padding: 0.5rem 1rem;\n  font-size: 15px;\n  color: #999;\n}\n",""])},JYf8:function(t,e,a){(t.exports=a("FZ+f")(!1)).push([t.i,"\n.select-commodity-dialog .el-dialog{\n  min-width: 800px;\n}\n",""])},"Ry/C":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("d7EF"),n=a.n(i),o=a("woOf"),r=a.n(o),s=a("gmf0"),l=a("YK4W"),c=a("Dd8w"),m=a.n(c),u=a("M4fF"),p=a.n(u),d=a("0xDb"),_={name:"selectCommodity",model:{},props:{value:{},show:{type:Boolean,default:!1}},components:{customElTable:l.a},data:function(){return{commodityQueryFrm:{name:"",choose_status:""},tableOptions:[{label:"ID",prop:"id",width:80},{label:"商品",prop:"name"},{label:"创建时间",prop:"create_time",sortable:!0,width:140},{prop:"USER_ACTION",actions:[{type:"status",options:this.getStatusBtnInfo}]}],query:null,tableData:[],pageIndex:1,pageSize:10,totalCount:0,tabLoading:!0,statusOptions:[{label:"全部",value:0},{label:"可选取",value:1},{label:"不可选",value:2}]}},computed:{dialogSelectCommodityVisible:{set:function(t){this.$emit("update:show",t)},get:function(){return this.show}}},watch:{show:function(t){t&&this.getData()}},methods:{getData:function(){var t=this,e=this.query||{};this.tabLoading=!0,s.a.goods(m()({page_index:this.pageIndex,page_size:this.pageSize},e)).then(function(e){t.tableData=(e.result||[]).map(function(t){return m()({},t,{create_time:Object(d.c)(t.create_time)})}),t.totalCount=1*e.totalCount,t.tabLoading=!1})},cancel:function(){this.dialogSelectCommodityVisible=!1},ok:function(){this.dialogSelectCommodityVisible=!1},pageChangeHandler:function(t){this.pageIndex=t,this.getData()},searchCommodityList:function(){this.query=p.a.cloneDeep(this.commodityQueryFrm),this.pageIndex=1,this.getData()},createCommodity:function(){this.$router.push({name:"fightGroupCommodityCreate"})},getStatusBtnInfo:function(t){return t&&1===1*t.can_choose?{btn:"primary",label:"选取",disabled:!0}:{btn:"danger",label:"不可选"}},actionHandler:function(t,e){var a=this;"status"===t&&1*e.can_choose==1&&this.$confirm("确认选取商品 <b>"+e.name+"</b> 吗？","确认",{dangerouslyUseHTMLString:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.$emit("input",e),a.dialogSelectCommodityVisible=!1}).catch(function(){console.log("取消选取")})}}},v={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"select-commodity-dialog",attrs:{title:"选择商品",visible:t.dialogSelectCommodityVisible},on:{"update:visible":function(e){t.dialogSelectCommodityVisible=e}}},[a("div",{staticClass:"control-group"},[a("el-form",{attrs:{inline:!0,model:t.commodityQueryFrm,size:"mini"}},[a("el-form-item",{attrs:{label:"商品名"}},[a("el-input",{attrs:{placeholder:"商品名"},model:{value:t.commodityQueryFrm.name,callback:function(e){t.$set(t.commodityQueryFrm,"name",e)},expression:"commodityQueryFrm.name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"商品状态"}},[a("el-select",{attrs:{placeholder:"全部",clearable:""},model:{value:t.commodityQueryFrm.choose_status,callback:function(e){t.$set(t.commodityQueryFrm,"choose_status",e)},expression:"commodityQueryFrm.choose_status"}},t._l(t.statusOptions,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.searchCommodityList}},[t._v("查询")])],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.createCommodity}},[a("i",{staticClass:"fs-13 el-icon-plus mr-5"}),t._v("发布商品\n        ")])],1)],1)],1),t._v(" "),a("custom-el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.tabLoading,expression:"tabLoading"}],attrs:{tableData:t.tableData,tableOptions:t.tableOptions,total:t.totalCount,pageSizes:[],size:t.pageSize,maxHeight:"455"},on:{action:t.actionHandler,"page-change":t.pageChangeHandler},model:{value:t.pageIndex,callback:function(e){t.pageIndex=e},expression:"pageIndex"}})],1)},staticRenderFns:[]};var y=a("VU/8")(_,v,!1,function(t){a("89hN")},null,null).exports,g={name:"activityEditor",components:{customElTable:l.a,selectCommodity:y},data:function(){var t=this;return{pageLoading:!0,action:this.$route.params.id?"modify":"add",activityFrm:{id:this.$route.params.id||0,merchant_name:"",merchant_contact_name:"",merchant_phone:"",goods_id:"",active_name:"",share_desc:"",person_num:"",group_time:[1,0,0,0],group_validate_time_days:1,group_validate_time_hours:0,group_validate_time_minutes:0,group_validate_time_seconds:0,payment_time:[1,0,0],order_pay_time_days:1,order_pay_time_hours:0,order_pay_time_minutes:0,order_pay_time_seconds:0,active_time:[],start_time:"",end_time:"",buy_max_num:0,buy_join_type:0,group_type:0,price:0,sort:""},buyMaxEnable:!1,frmRules:{merchant_name:[{required:!1,message:"请填写商户名称"}],merchant_contact_name:[{required:!1,message:"请填写联系人"}],merchant_phone:[{required:!1,message:"请填写联系方式"}],goods_id:[{required:!0,message:"请选择一个商品"}],active_name:[{required:!0,message:"请填写活动名称"}],share_desc:[{required:!0,message:"请填写分享描述"}],active_time:[{required:!0,message:"请选择活动有效期时间"}],group_time:[{validator:function(t,e,a){e[0]||e[1]||e[2]||e[3]?a():a(new Error("请选择活动拼团有效期时间"))}}],payment_time:[{validator:function(t,e,a){e[0]||e[1]||e[2]||e[3]?a():a(new Error("请选择拼团支付有效期时间"))}}]},startPickerOptions:{disabledDate:function(t){var e=new Date;return+t<+new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()+" 00:00")}},activityEndPickerOptions:{disabledDate:function(e){var a=new Date;if(t.activityFrm.start_time){var i=new Date(t.activityFrm.start_time);+i>+a&&(a=i)}return+e<+new Date(a.getFullYear()+"/"+(a.getMonth()+1)+"/"+a.getDate()+" 00:00")}},groupEndPickerOptions:{disabledDate:function(e){var a=new Date;if(t.activityFrm.group_start_time){var i=new Date(t.activityFrm.group_start_time);+i>+a&&(a=i)}return+e<+new Date(a.getFullYear()+"/"+(a.getMonth()+1)+"/"+a.getDate()+" 00:00")}},showSelectCommodity:!1,selectedGoodsInfo:null}},watch:{selectedGoodsInfo:function(t){t&&this.$set(this.activityFrm,"goods_id",t.id)}},computed:{},created:function(){this.getDetail()},methods:{getDetail:function(){var t=this;if("add"===this.action)return this.pageLoading=!1;s.a.get(this.activityFrm.id).then(function(e){var a=Object(d.c)(1e3*e.start_time),i=1*e.end_time?Object(d.c)(1e3*e.end_time):"";e.active_time=[a,i],e.group_time=[e.group_validate_time_days||0,e.group_validate_time_hours||0,e.group_validate_time_minutes||0,e.group_validate_time_seconds||0],e.payment_time=[e.order_pay_time_days||0,e.order_pay_time_hours||0,e.order_pay_time_minutes||0],t.activityFrm=p.a.assign({},t.activityFrm,e),t.buyMaxEnable=1*e.buy_max_num>0,t.selectedGoodsInfo=e.goods_info,t.pageLoading=!1}).catch(function(){t.pageLoading=!1})},save:function(){var t=this;this.$refs.activityFrm.validate(function(e){if(e){var a=r()({},t.activityFrm);a.start_time=a.active_time[0],a.end_time=a.active_time[1];var i=n()(a.group_time,4);a.group_validate_time_days=i[0],a.group_validate_time_hours=i[1],a.group_validate_time_minutes=i[2],a.group_validate_time_seconds=i[3];var o=n()(a.payment_time,3);a.order_pay_time_days=o[0],a.order_pay_time_hours=o[1],a.order_pay_time_minutes=o[2],delete a.group_time,delete a.payment_time,("modify"===t.action?s.a.edit(a):s.a.add(a)).then(function(){t.$router.back()})}})}}},h={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.pageLoading,expression:"pageLoading"}],staticClass:"app-container"},[a("el-form",{ref:"activityFrm",staticClass:"activity-edit__form",attrs:{model:t.activityFrm,rules:t.frmRules,"label-width":"120px"}},[a("header",[t._v("商户信息")]),t._v(" "),a("el-form-item",{attrs:{prop:"merchant_name",label:"商户名称"}},[a("el-input",{attrs:{placeholder:"请输入商户名称",maxlength:50,name:"merchant_name",clearable:!0},model:{value:t.activityFrm.merchant_name,callback:function(e){t.$set(t.activityFrm,"merchant_name",e)},expression:"activityFrm.merchant_name"}})],1),t._v(" "),a("el-form-item",{attrs:{prop:"merchant_contact_name",label:"联系人"}},[a("el-input",{attrs:{maxlength:20,placeholder:"请输入联系人名称",name:"merchant_contact_name",clearable:!0},model:{value:t.activityFrm.merchant_contact_name,callback:function(e){t.$set(t.activityFrm,"merchant_contact_name",e)},expression:"activityFrm.merchant_contact_name"}})],1),t._v(" "),a("el-form-item",{attrs:{prop:"merchant_phone",label:"联系方式"}},[a("el-input",{attrs:{type:"tel",maxlength:11,placeholder:"请输入活动名称",name:"merchant_phone",clearable:!0},model:{value:t.activityFrm.merchant_phone,callback:function(e){t.$set(t.activityFrm,"merchant_phone",e)},expression:"activityFrm.merchant_phone"}})],1),t._v(" "),a("header",[t._v("活动信息")]),t._v(" "),a("el-form-item",{attrs:{prop:"goods_id",label:"选择商品"}},[t.selectedGoodsInfo?a("div",{staticClass:"selected-goods-preview"},[a("div",{staticClass:"selected-goods-pic"},[t.selectedGoodsInfo.pic&&t.selectedGoodsInfo.pic.length?a("img",{attrs:{src:t.selectedGoodsInfo.pic[0].file_path}}):t._e()]),t._v(" "),a("small",{staticClass:"text-666"},[t._v("商户名称："+t._s(t.selectedGoodsInfo.name))])]):t._e(),t._v(" "),a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(e){t.showSelectCommodity=!0}}},[t._v("选择商品")])],1),t._v(" "),a("el-form-item",{attrs:{prop:"active_name",label:"活动名称"}},[a("el-input",{attrs:{placeholder:"请输入活动名称",maxlength:20,name:"active_name",clearable:!0},model:{value:t.activityFrm.active_name,callback:function(e){t.$set(t.activityFrm,"active_name",e)},expression:"activityFrm.active_name"}})],1),t._v(" "),a("el-form-item",{attrs:{prop:"share_desc",label:"分享描述"}},[a("el-input",{attrs:{placeholder:"微信分享给好友时显示",maxlength:26,name:"share_desc",clearable:!0},model:{value:t.activityFrm.share_desc,callback:function(e){t.$set(t.activityFrm,"share_desc",e)},expression:"activityFrm.share_desc"}})],1),t._v(" "),a("el-form-item",{attrs:{prop:"person_num",label:"拼团类型"}},[a("el-input-number",{attrs:{min:2,max:100,name:"person_num"},model:{value:t.activityFrm.person_num,callback:function(e){t.$set(t.activityFrm,"person_num",e)},expression:"activityFrm.person_num"}}),t._v(" "),a("span",{staticClass:"ml-5 text-666"},[t._v("人")])],1),t._v(" "),a("el-form-item",{attrs:{prop:"active_time",label:"活动有效期"}},[a("el-date-picker",{attrs:{editable:!1,type:"datetimerange","picker-options":t.startPickerOptions,"range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间","value-format":"yyyy-MM-dd HH:mm:ss",align:"right"},model:{value:t.activityFrm.active_time,callback:function(e){t.$set(t.activityFrm,"active_time",e)},expression:"activityFrm.active_time"}}),t._v(" "),a("p",{staticClass:"text-999"},[a("small",[t._v("拼团活动有效期")])])],1),t._v(" "),a("el-form-item",{attrs:{prop:"group_time",label:"拼团有效期"}},[a("el-select",{staticStyle:{width:"66px"},attrs:{placeholder:"-"},model:{value:t.activityFrm.group_time[0],callback:function(e){t.$set(t.activityFrm.group_time,0,e)},expression:"activityFrm.group_time[0]"}},t._l(31,function(t){return a("el-option",{key:t,attrs:{label:31-t,value:31-t}})})),t._v(" "),a("span",{staticClass:"mh-5 text-666"},[t._v("天")]),t._v(" "),a("el-select",{staticStyle:{width:"66px"},attrs:{placeholder:"-"},model:{value:t.activityFrm.group_time[1],callback:function(e){t.$set(t.activityFrm.group_time,1,e)},expression:"activityFrm.group_time[1]"}},t._l(60,function(t){return a("el-option",{key:t,attrs:{label:60-t,value:60-t}})})),t._v(" "),a("span",{staticClass:"mh-5 text-666"},[t._v("时")]),t._v(" "),a("el-select",{staticStyle:{width:"66px"},attrs:{placeholder:"-"},model:{value:t.activityFrm.group_time[2],callback:function(e){t.$set(t.activityFrm.group_time,2,e)},expression:"activityFrm.group_time[2]"}},t._l(60,function(t){return a("el-option",{key:t,attrs:{label:60-t,value:60-t}})})),t._v(" "),a("span",{staticClass:"mh-5 text-666"},[t._v("分")]),t._v(" "),a("p",{staticClass:"text-999"},[a("small",[t._v("拼团活动下，用户参团或开团到成团的最大时间，超过该时间，拼团失败")])])],1),t._v(" "),a("el-form-item",{attrs:{prop:"payment_time",label:"支付有效期"}},[a("el-select",{staticStyle:{width:"66px"},attrs:{placeholder:"-"},model:{value:t.activityFrm.payment_time[0],callback:function(e){t.$set(t.activityFrm.payment_time,0,e)},expression:"activityFrm.payment_time[0]"}},t._l(31,function(t){return a("el-option",{key:t,attrs:{label:31-t,value:31-t}})})),t._v(" "),a("span",{staticClass:"mh-5 text-666"},[t._v("天")]),t._v(" "),a("el-select",{staticStyle:{width:"66px"},attrs:{placeholder:"-"},model:{value:t.activityFrm.payment_time[1],callback:function(e){t.$set(t.activityFrm.payment_time,1,e)},expression:"activityFrm.payment_time[1]"}},t._l(60,function(t){return a("el-option",{key:t,attrs:{label:60-t,value:60-t}})})),t._v(" "),a("span",{staticClass:"mh-5 text-666"},[t._v("时")]),t._v(" "),a("el-select",{staticStyle:{width:"66px"},attrs:{placeholder:"-"},model:{value:t.activityFrm.payment_time[2],callback:function(e){t.$set(t.activityFrm.payment_time,2,e)},expression:"activityFrm.payment_time[2]"}},t._l(60,function(t){return a("el-option",{key:t,attrs:{label:60-t,value:60-t}})})),t._v(" "),a("span",{staticClass:"mh-5 text-666"},[t._v("分")]),t._v(" "),a("p",{staticClass:"text-999"},[a("small",[t._v("用户提交订单后，选择支付的剩余的时间(为0时，支付有效期即为拼团有效期)")])])],1),t._v(" "),a("el-form-item",{attrs:{prop:"buy_max_num",label:"开启限购"}},[a("el-checkbox",{model:{value:t.buyMaxEnable,callback:function(e){t.buyMaxEnable=e},expression:"buyMaxEnable"}},[t._v("\n        开启限购\n        "),a("el-input",{staticClass:"limit-count__input",attrs:{type:"num",name:"buy_max_num",min:0,size:"mini",disabled:!t.buyMaxEnable},model:{value:t.activityFrm.buy_max_num,callback:function(e){t.$set(t.activityFrm,"buy_max_num",e)},expression:"activityFrm.buy_max_num"}}),t._v("\n        件/人\n      ")],1)],1),t._v(" "),a("el-form-item",{attrs:{prop:"buy_join_type",label:"凑团设置"}},[a("el-checkbox",{attrs:{"true-label":1,"false-label":0},model:{value:t.activityFrm.buy_join_type,callback:function(e){t.$set(t.activityFrm,"buy_join_type",e)},expression:"activityFrm.buy_join_type"}},[t._v("\n        开启凑团\n      ")]),t._v(" "),a("p",{staticClass:"text-999"},[a("small",[t._v("开启凑团后，对于未参团的买家，活动商品详情页会显示未成团的团列表，买家可以直接任选一个参团，提升成团率。")])])],1),t._v(" "),a("el-form-item",{attrs:{prop:"buy_join_type",label:"机器人成团"}},[a("el-checkbox",{attrs:{"true-label":1,"false-label":0},model:{value:t.activityFrm.group_type,callback:function(e){t.$set(t.activityFrm,"group_type",e)},expression:"activityFrm.group_type"}},[t._v("\n        开启机器人成团\n      ")]),t._v(" "),a("p",{staticClass:"text-999"},[a("small",[t._v("开启机器人成团后，拼团有效期内人数未满的团，系统将会模拟“匿名买家”凑满人数，使该团成团。你只需要对已付款参团的真实买家发货")])])],1),t._v(" "),a("el-form-item",{attrs:{prop:"price",label:"商品活动价"}},[a("el-input-number",{attrs:{min:0,name:"price"},model:{value:t.activityFrm.price,callback:function(e){t.$set(t.activityFrm,"price",e)},expression:"activityFrm.price"}}),t._v(" "),a("span",{staticClass:"ml-5 text-666"},[t._v("元")])],1),t._v(" "),a("el-form-item",{attrs:{prop:"sort",label:"权重值"}},[a("el-input-number",{attrs:{min:0,name:"sort"},model:{value:t.activityFrm.sort,callback:function(e){t.$set(t.activityFrm,"sort",e)},expression:"activityFrm.sort"}}),t._v(" "),a("small",{staticClass:"text-999",staticStyle:{"margin-left":"50px"}},[t._v("（0-1000）活动权重值越高，展示顺序越靠前")])],1),t._v(" "),a("el-form-item",[a("el-button",{on:{click:function(e){e.preventDefault(),e.stopPropagation(),t.$router.back()}}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){e.preventDefault(),e.stopPropagation(),t.save(e)}}},[t._v("保存")])],1)],1),t._v(" "),a("select-commodity",{attrs:{show:t.showSelectCommodity},on:{"update:show":function(e){t.showSelectCommodity=e}},model:{value:t.selectedGoodsInfo,callback:function(e){t.selectedGoodsInfo=e},expression:"selectedGoodsInfo"}})],1)},staticRenderFns:[]};var f=a("VU/8")(g,h,!1,function(t){a("xEpY"),a("b0sT")},"data-v-490c7a04",null);e.default=f.exports},b0sT:function(t,e,a){var i=a("mp1V");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);a("rjj0")("9aa55cea",i,!0)},gmf0:function(t,e,a){"use strict";var i=a("gyMJ");e.a={list:function(t){return i.a.get("/groupBuy/v1/active/active/get-list",{params:t}).then(function(t){return t.data})},del:function(t){return i.a.delete("/groupBuy/v1/active/active/del",{params:{id:t.id},autoShowMessage:!0})},status:function(t){return i.a.post("/groupBuy/v1/active/active/change-status",{id:t.id,status:1*!(1*t.status)},{autoShowMessage:!0,showMessageType:"put"})},get:function(t){return i.a.get("/groupBuy/v1/active/active/get-one?id="+t).then(function(t){return t.data})},add:function(t){return i.a.post("/groupBuy/v1/active/active/add",t,{autoShowMessage:!0})},edit:function(t){return i.a.put("/groupBuy/v1/active/active/edit",t,{autoShowMessage:!0,showMessageType:"put"})},goods:function(t){return i.a.get("/groupBuy/v1/goods/goods/get-active-choose-goods",{params:t}).then(function(t){return t.data})}}},mp1V:function(t,e,a){(t.exports=a("FZ+f")(!1)).push([t.i,"\n.selected-goods-preview .selected-goods-pic[data-v-490c7a04] {\n  position: relative;\n  width: 120px;\n  height: 120px;\n  border: 1px solid #e2e2e2;\n  overflow: hidden;\n  border-radius: 5px;\n}\n.selected-goods-preview .selected-goods-pic > img[data-v-490c7a04] {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    max-width: 100%;\n    max-height: 100%;\n    -webkit-transform: translate(-50%, -50%);\n            transform: translate(-50%, -50%);\n}\n",""])},xEpY:function(t,e,a){var i=a("EfIZ");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);a("rjj0")("371e4167",i,!0)}});