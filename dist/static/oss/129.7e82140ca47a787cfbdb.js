webpackJsonp([129],{"31Ux":function(t,e,a){var i=a("AnXj");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);a("rjj0")("73a477ec",i,!0)},AnXj:function(t,e,a){(t.exports=a("FZ+f")(!1)).push([t.i,"\n.article_pages[data-v-1240cb0a]{\r\n  text-align: right;\r\n  margin: 5px 0 0;\n}\n.avatar-uploader .el-upload[data-v-1240cb0a] {\r\n  position: relative;\r\n  overflow: hidden;\n}\n.avatar-uploader .el-upload[data-v-1240cb0a]:hover {\r\n  border-color: #409EFF;\n}\n.avatar-uploader-icon[data-v-1240cb0a] {\r\n  font-size: 28px;\r\n  color: #8c939d;\r\n  width: 178px;\r\n  height: 178px;\r\n  line-height: 178px;\r\n  text-align: center;\r\n  border: 1px dashed #d9d9d9;\r\n  border-radius: 6px;\r\n  cursor: pointer;\n}\n.avatar[data-v-1240cb0a] {\r\n  width: 178px;\r\n  height: 178px;\r\n  display: block;\n}\r\n",""])},BocD:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("Dd8w"),o=a.n(i),n=a("sF3O"),r=a("5aCZ"),s=a("uzBN"),p={name:"uploadWork",components:{Tinymce:r.a},data:function(){return{topicFrm:{activity_id:"",stage_id:"",mission_id:"",type:"",title:"",description:"",detail:""},wotks:[],stage:[],task:[],wotks_page_info:{pageIndex:1,pageSize:10,totalCount:1},stage_page_info:{pageIndex:1,pageSize:10,totalCount:1},task_page_info:{pageIndex:1,pageSize:10,totalCount:1},uploadPercent:0,showImageDel:!1,isUploadLoading:!1,frmRules:{activity_id:[{required:!0,message:"请选择活动"}],stage_id:[{required:!0,message:"请选择阶段"}],mission_id:[{required:!0,message:"请选择任务"}],title:[{required:!0,message:"请输入作品名称"}],description:[{required:!0,message:"请输入作品描述"}],detail:[{required:!0,message:"请添加作品"}]}}},created:function(){this.getWorks()},methods:{getWorks:function(){var t=this;n.a.activity.list({pageIndex:this.wotks_page_info.pageIndex,pageSize:this.wotks_page_info.pageSize}).then(function(e){t.wotks_page_info={pageIndex:1*e.pageIndex,pageSize:1*e.pageSize,totalCount:1*e.totalCount},t.wotks=e.result.map(function(t){return o()({},t,{id:parseInt(t.id)})})})},getStage:function(){var t=this;this.topicFrm.stage_id="",this.topicFrm.mission_id="",this.stage=[],this.task=[],n.a.stage.list(this.topicFrm.activity_id,{pageIndex:this.stage_page_info.pageIndex,pageSize:this.stage_page_info.pageSize}).then(function(e){t.stage_page_info={pageIndex:1*e.pageIndex,pageSize:1*e.pageSize,totalCount:1*e.totalCount},t.stage=e.result.map(function(t){return o()({},t,{id:parseInt(t.id)})})})},getTask:function(){var t=this;this.topicFrm.mission_id="",this.task=[],n.a.task.list({page_index:this.task_page_info.pageIndex,page_size:this.task_page_info.pageSize}).then(function(e){t.task_page_info={pageIndex:1*e.pageIndex,pageSize:1*e.pageSize,totalCount:1*e.totalCount},t.task=e.result.map(function(t){return o()({},t,{id:parseInt(t.id)})})})},getType:function(){var t=this;this.topicFrm.detail="",this.task.forEach(function(e){e.id!==t.topicFrm.mission_id||(t.topicFrm.type=e.type)})},beforeWorkUpload:function(t){return this.topicFrm.type?this.topicFrm.type-0==1&&"video"!==t.type.split("/")[0]?(this.$message({type:"error",message:"请上传视频类作品"}),!1):this.topicFrm.type-0==2&&"image"!==t.type.split("/")[0]?(this.$message({type:"error",message:"请上传图片类作品"}),!1):this.topicFrm.type-0==5&&"audio"!==t.type.split("/")[0]?(this.$message({type:"error",message:"请上传音频类作品"}),!1):void 0:(this.$message({type:"error",message:"请先选择任务"}),!1)},uploadAction:function(t){var e=this;this.isUploadLoading=!0,s.a.img(t.file,"file",function(t){e.uploadPercent=Math.min(99,Math.floor(100*t.loaded/t.total))}).then(function(t){e.topicFrm.detail=t.url,e.isUploadLoading=!1,e.uploadPercent=100}).catch(function(){e.isUploadLoading=!1,e.uploadPercent=0})},currentChangeActivity:function(t){this.wotks_page_info.pageIndex=t,this.getWorks()},currentChangeStage:function(t){this.stage_page_info.pageIndex=t,this.getStage()},currentChangeTask:function(t){this.task_page_info.pageIndex=t,this.getTask()},save:function(){var t=this;this.$refs.groupFrm.validate(function(e){e&&n.a.task.addPlayerWork(t.topicFrm).then(function(e){t.$router.replace({name:"wotksList"})})})}}},l={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container"},[a("el-form",{ref:"groupFrm",staticClass:"code-add__frm",attrs:{model:t.topicFrm,rules:t.frmRules,"label-width":"80px"}},[a("el-form-item",{attrs:{prop:"activity_id",label:"活动名称"}},[a("el-select",{attrs:{placeholder:"请选择活动名称"},on:{change:t.getStage},model:{value:t.topicFrm.activity_id,callback:function(e){t.$set(t.topicFrm,"activity_id",e)},expression:"topicFrm.activity_id"}},[t._l(t.wotks,function(t){return a("el-option",{key:t.id,attrs:{label:t.activity_name,value:t.id}})}),t._v(" "),a("div",{staticClass:"article_pages"},[a("el-pagination",{attrs:{"page-size":t.wotks_page_info.pageSize,"pager-count":Math.ceil(t.wotks_page_info.totalCount/t.wotks_page_info.pageSize),"current-page":t.wotks_page_info.pageIndex,layout:"prev, pager, next",total:t.wotks_page_info.totalCount},on:{"current-change":t.currentChangeActivity}})],1)],2)],1),t._v(" "),a("el-form-item",{attrs:{prop:"stage_id",label:"阶段名称"}},[a("el-select",{attrs:{placeholder:"请选择活动名称"},on:{change:t.getTask},model:{value:t.topicFrm.stage_id,callback:function(e){t.$set(t.topicFrm,"stage_id",e)},expression:"topicFrm.stage_id"}},[t._l(t.stage,function(t){return a("el-option",{key:t.id,attrs:{label:t.stage_name,value:t.id}})}),t._v(" "),a("div",{staticClass:"article_pages"},[a("el-pagination",{attrs:{"page-size":t.stage_page_info.pageSize,"pager-count":Math.ceil(t.stage_page_info.totalCount/t.stage_page_info.pageSize),"current-page":t.stage_page_info.pageIndex,layout:"prev, pager, next",total:t.stage_page_info.totalCount},on:{"current-change":t.currentChangeStage}})],1)],2)],1),t._v(" "),a("el-form-item",{attrs:{prop:"mission_id",label:"任务名称"}},[a("el-select",{attrs:{placeholder:"请选择活动名称"},on:{change:t.getType},model:{value:t.topicFrm.mission_id,callback:function(e){t.$set(t.topicFrm,"mission_id",e)},expression:"topicFrm.mission_id"}},[t._l(t.task,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),t._v(" "),a("div",{staticClass:"article_pages"},[a("el-pagination",{attrs:{"page-size":t.task_page_info.pageSize,"pager-count":Math.ceil(t.task_page_info.totalCount/t.task_page_info.pageSize),"current-page":t.task_page_info.pageIndex,layout:"prev, pager, next",total:t.task_page_info.totalCount},on:{"current-change":t.currentChangeTask}})],1)],2)],1),t._v(" "),a("el-form-item",{attrs:{prop:"title",label:"作品名称"}},[a("el-input",{attrs:{name:"title",clearable:!0,placeholder:"请输入作品名称"},model:{value:t.topicFrm.title,callback:function(e){t.$set(t.topicFrm,"title",e)},expression:"topicFrm.title"}})],1),t._v(" "),a("el-form-item",{attrs:{prop:"description",label:"作品描述"}},[a("el-input",{attrs:{name:"description",clearable:!0,placeholder:"请输入作品描述"},model:{value:t.topicFrm.description,callback:function(e){t.$set(t.topicFrm,"description",e)},expression:"topicFrm.description"}})],1),t._v(" "),a("el-form-item",{attrs:{prop:"detail",label:"添加作品"}},[3==t.topicFrm.type?a("el-input",{attrs:{type:"textarea",rows:4,placeholder:"请输入内容"},model:{value:t.topicFrm.detail,callback:function(e){t.$set(t.topicFrm,"detail",e)},expression:"topicFrm.detail"}}):4==t.topicFrm.type?a("tinymce",{attrs:{placeholder:"请输入内容",height:300},model:{value:t.topicFrm.detail,callback:function(e){t.$set(t.topicFrm,"detail",e)},expression:"topicFrm.detail"}}):a("el-upload",{directives:[{name:"show",rawName:"v-show",value:!t.isUploadLoading,expression:"!isUploadLoading"}],staticClass:"avatar-uploader",attrs:{"before-upload":t.beforeWorkUpload,action:t.$store.state.uploadImgUrl,"http-request":t.uploadAction,"show-file-list":!1}},[t.topicFrm.detail&&1==t.topicFrm.type?a("video",{staticStyle:{"margin-left":"20px"},attrs:{src:t.topicFrm.detail,controls:"controls",width:"600px",height:"380px"}}):t.topicFrm.detail&&2==t.topicFrm.type?a("img",{staticClass:"avatar",attrs:{src:t.topicFrm.detail}}):t.topicFrm.detail&&5==t.topicFrm.type?a("audio",{staticStyle:{"margin-left":"20px"},attrs:{src:t.topicFrm.detail,controls:"controls"}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]),t._v(" "),a("el-progress",{directives:[{name:"show",rawName:"v-show",value:t.isUploadLoading,expression:"isUploadLoading"}],attrs:{type:"circle",percentage:t.uploadPercent}})],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(e){e.preventDefault(),e.stopPropagation(),t.save(e)}}},[t._v("保存")]),t._v(" "),a("el-button",{on:{click:function(e){t.$router.back()}}},[t._v("取消")])],1)],1)],1)},staticRenderFns:[]};var c=a("VU/8")(p,l,!1,function(t){a("31Ux")},"data-v-1240cb0a",null);e.default=c.exports}});